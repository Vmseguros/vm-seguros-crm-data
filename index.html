<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VM SEGUROS - CRM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        .scrollbar-thin::-webkit-scrollbar { width: 4px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: #1f2937; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #4b5563; }
        .loading-spinner { border: 3px solid #f3f3f3; border-top: 3px solid #3498db; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .hover-scale:hover { transform: scale(1.05); transition: transform 0.2s ease; }
        .kanban-card { transition: all 0.3s ease; cursor: move; }
        .kanban-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); }
        .nav-item.active { background-color: #374151; color: white; }
        .notification { position: fixed; top: 20px; right: 20px; z-index: 1000; min-width: 300px; animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body class="bg-gray-900 font-sans">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center bg-gradient-to-br from-blue-900 to-gray-900">
        <div class="bg-gray-800 p-8 rounded-xl shadow-2xl w-full max-w-md border border-gray-700 fade-in">
            <div class="text-center mb-8">
                <div class="bg-gradient-to-r from-blue-600 to-purple-600 w-20 h-20 rounded-full mx-auto mb-4 flex items-center justify-center">
                    <i class="fas fa-shield-alt text-white text-3xl"></i>
                </div>
                <h1 class="text-3xl font-bold text-white mb-2">VM SEGUROS</h1>
                <p class="text-gray-400">Sistema de Gest√£o CRM</p>
            </div>
            
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-gray-300 text-sm font-medium mb-2">Usu√°rio</label>
                    <input type="text" id="username" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" placeholder="Digite seu usu√°rio" required>
                </div>
                <div>
                    <label class="block text-gray-300 text-sm font-medium mb-2">Senha</label>
                    <input type="password" id="password" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" placeholder="Digite sua senha" required>
                </div>
                <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-medium py-3 px-4 rounded-lg transition duration-200">
                    <i class="fas fa-sign-in-alt mr-2"></i>Entrar
                </button>
            </form>
            
            <div class="mt-6 p-4 bg-gray-700 rounded-lg max-h-48 overflow-y-auto scrollbar-thin">
                <h3 class="text-white font-medium mb-3">üë• Credenciais de Acesso:</h3>
                <div class="text-xs text-gray-300 space-y-2">
                    <div class="bg-red-900 bg-opacity-30 p-2 rounded border border-red-600">
                        <p class="text-red-300 font-bold">üîë ADMIN:</p>
                        <p><strong>Login:</strong> admin</p>
                        <p><strong>Senha:</strong> admin123</p>
                    </div>
                    <div class="bg-blue-900 bg-opacity-30 p-2 rounded border border-blue-600">
                        <p class="text-blue-300 font-bold">üë®‚Äçüíº VENDEDORES:</p>
                        <div class="grid grid-cols-1 gap-1 mt-1">
                            <p><strong>Igor Vicente:</strong> igor.vicente / Realmadridfc12@</p>
                            <p><strong>Rodrigo Mariano:</strong> rodrigo / ninjinha10</p>
                            <p><strong>Jessica Regis:</strong> jessica.regis / jessica123</p>
                            <p><strong>Jaqueline Brito:</strong> jaqueline.brito / jaque123</p>
                            <p><strong>Jessica Brito:</strong> jessica.brito / jbrito123</p>
                            <p><strong>Luana Vieira:</strong> luana.vieira / luana123</p>
                            <p><strong>Leonardo Ferreira:</strong> leonardo.ferreira / leo123</p>
                            <p><strong>Ana Beatriz:</strong> ana.beatriz / ana123</p>
                            <p><strong>Elen Jaconis:</strong> elen.jaconis / elen123</p>
                            <p><strong>Usuario 1:</strong> usuario1 / user123</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main CRM System -->
    <div id="crmSystem" class="hidden">
        <!-- Header -->
        <header class="bg-gray-800 border-b border-gray-700 px-6 py-4 sticky top-0 z-40">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div class="bg-gradient-to-r from-blue-600 to-purple-600 w-10 h-10 rounded-lg flex items-center justify-center">
                        <i class="fas fa-shield-alt text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-white">VM SEGUROS</h1>
                        <span class="text-xs text-gray-400">Sistema CRM</span>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div id="connectionStatus" class="text-sm text-gray-400">
                        <i class="fas fa-wifi text-gray-500"></i> Conectando...
                    </div>
                    <div id="onlineUsers" class="text-sm text-gray-400 hidden md:block">
                        0 usu√°rios online
                    </div>
                    <span class="text-gray-300 hidden md:block">Bem-vindo, <span id="currentUser" class="font-medium text-white">Admin</span></span>
                    <button onclick="logout()" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition duration-200">
                        <i class="fas fa-sign-out-alt mr-2"></i>Sair
                    </button>
                </div>
            </div>
        </header>

        <!-- Mobile Menu Toggle -->
        <div class="md:hidden bg-gray-800 px-6 py-2">
            <button onclick="toggleMobileMenu()" class="text-white">
                <i class="fas fa-bars"></i> Menu
            </button>
        </div>

        <!-- Main Layout -->
        <div class="flex">
            <!-- Sidebar -->
            <aside id="sidebar" class="w-64 bg-gray-800 min-h-screen border-r border-gray-700 fixed md:relative z-30 transform -translate-x-full md:translate-x-0 transition-transform duration-300">
                <nav class="p-4">
                    <ul class="space-y-2">
                        <li><button onclick="showSection('dashboard', this)" class="nav-item w-full text-left px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition duration-200 flex items-center"><i class="fas fa-tachometer-alt mr-3"></i>Dashboard</button></li>
                        <li><button onclick="showSection('kanban-vendas', this)" class="nav-item w-full text-left px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition duration-200 flex items-center"><i class="fas fa-columns mr-3"></i>Kanban Vendas</button></li>
                        <li><button onclick="showSection('kanban-indicacoes', this)" class="nav-item w-full text-left px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition duration-200 flex items-center"><i class="fas fa-columns mr-3"></i>Kanban Indica√ß√µes</button></li>
                        <li><button onclick="showSection('indicacoes', this)" class="nav-item w-full text-left px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition duration-200 flex items-center"><i class="fas fa-handshake mr-3"></i>Indica√ß√µes</button></li>
                        <li><button onclick="showSection('vendas', this)" class="nav-item w-full text-left px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition duration-200 flex items-center"><i class="fas fa-chart-line mr-3"></i>Vendas</button></li>
                        <li><button onclick="showSection('vendedores', this)" class="nav-item w-full text-left px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition duration-200 flex items-center"><i class="fas fa-users mr-3"></i>Vendedores</button></li>
                        <li><button onclick="showSection('comissao', this)" class="nav-item w-full text-left px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition duration-200 flex items-center"><i class="fas fa-percentage mr-3"></i>Comiss√£o</button></li>
                        <li><button onclick="showSection('cancelamentos', this)" class="nav-item w-full text-left px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition duration-200 flex items-center"><i class="fas fa-times-circle mr-3"></i>Cancelamentos</button></li>
                        <li><button onclick="showSection('relatorios', this)" class="nav-item w-full text-left px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition duration-200 flex items-center"><i class="fas fa-file-alt mr-3"></i>Relat√≥rios</button></li>
                        <li><button onclick="showSection('links-uteis', this)" class="nav-item w-full text-left px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition duration-200 flex items-center"><i class="fas fa-link mr-3"></i>Links √öteis</button></li>
                        <li><button onclick="showSection('sem-sucesso', this)" class="nav-item w-full text-left px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition duration-200 flex items-center"><i class="fas fa-exclamation-triangle mr-3"></i>Sem Sucesso</button></li>
                        <li><button onclick="showSection('lead-suhai', this)" class="nav-item w-full text-left px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition duration-200 flex items-center"><i class="fas fa-star mr-3"></i>Lead Suhai</button></li>
                        <li><button onclick="showSection('configuracoes', this)" class="nav-item w-full text-left px-4 py-3 text-gray-300 hover:bg-gray-700 hover:text-white rounded-lg transition duration-200 flex items-center"><i class="fas fa-cog mr-3"></i>Configura√ß√µes</button></li>
                    </ul>
                </nav>
            </aside>

            <!-- Mobile Overlay -->
            <div id="mobileOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-20 hidden md:hidden" onclick="toggleMobileMenu()"></div>

            <!-- Main Content -->
            <main class="flex-1 p-4 md:p-6 bg-gray-900 min-h-screen">
                <!-- Dashboard Section -->
                <div id="dashboard" class="section">
                    <div class="mb-6">
                        <h2 class="text-2xl md:text-3xl font-bold text-white mb-2">Dashboard</h2>
                        <p class="text-gray-400">Vis√£o geral do seu neg√≥cio</p>
                    </div>

                    <!-- Stats Cards -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6 mb-8">
                        <div class="bg-gray-800 p-4 md:p-6 rounded-xl border border-gray-700 hover-scale">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-400 text-sm">Leads do Dia</p>
                                    <p class="text-xl md:text-2xl font-bold text-white" id="leadsDoDia">0</p>
                                </div>
                                <div class="bg-blue-600 p-3 rounded-lg">
                                    <i class="fas fa-user-plus text-white text-xl"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-800 p-4 md:p-6 rounded-xl border border-gray-700 hover-scale">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-400 text-sm">Vendas do Dia</p>
                                    <p class="text-xl md:text-2xl font-bold text-white" id="vendasDoDia">0</p>
                                </div>
                                <div class="bg-green-600 p-3 rounded-lg">
                                    <i class="fas fa-chart-line text-white text-xl"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-800 p-4 md:p-6 rounded-xl border border-gray-700 hover-scale">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-400 text-sm">Pr√™mio L√≠quido do Dia</p>
                                    <p class="text-lg md:text-2xl font-bold text-white" id="premioLiquidoDia">R$ 0,00</p>
                                </div>
                                <div class="bg-yellow-600 p-3 rounded-lg">
                                    <i class="fas fa-dollar-sign text-white text-xl"></i>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-800 p-4 md:p-6 rounded-xl border border-gray-700 hover-scale">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-gray-400 text-sm">Pr√™mio L√≠quido do M√™s</p>
                                    <p class="text-lg md:text-2xl font-bold text-white" id="premioLiquidoMes">R$ 0,00</p>
                                </div>
                                <div class="bg-purple-600 p-3 rounded-lg">
                                    <i class="fas fa-trophy text-white text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Section -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        <div class="bg-gray-800 rounded-xl border border-gray-700 p-6">
                            <h3 class="text-xl font-bold text-white mb-4">Vendas por Vendedor (M√™s)</h3>
                            <div id="vendasPorVendedorChart" class="space-y-3"></div>
                        </div>

                        <div class="bg-gray-800 rounded-xl border border-gray-700 p-6">
                            <h3 class="text-xl font-bold text-white mb-4">Vendas por Empresa (M√™s)</h3>
                            <div id="vendasPorEmpresaChart" class="space-y-3"></div>
                        </div>
                    </div>

                    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6">
                        <h3 class="text-xl font-bold text-white mb-4">Atividade Recente</h3>
                        <div id="recentActivity" class="space-y-3"></div>
                    </div>
                </div>

                <!-- Kanban Vendas Section -->
                <div id="kanban-vendas" class="section hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl md:text-3xl font-bold text-white mb-2">Kanban Vendas</h2>
                        <p class="text-gray-400">Acompanhe o processo de vendas</p>
                    </div>

                    <div class="mb-4">
                        <button onclick="showNovaVendaModal()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition duration-200 flex items-center">
                            <i class="fas fa-plus mr-2"></i>Nova Venda
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6">
                        <div class="bg-gray-800 rounded-xl border border-gray-700 p-4">
                            <h3 class="text-lg font-bold text-white mb-4 flex items-center">
                                <div class="w-3 h-3 bg-yellow-500 rounded-full mr-2"></div>
                                Fazer Vistoria
                                <span class="ml-auto bg-yellow-600 text-white text-xs px-2 py-1 rounded-full" id="fazerVistoriaCount">0</span>
                            </h3>
                            <div id="fazerVistoriaContainer" class="space-y-2 min-h-[300px] max-h-[500px] overflow-y-auto scrollbar-thin"></div>
                        </div>

                        <div class="bg-gray-800 rounded-xl border border-gray-700 p-4">
                            <h3 class="text-lg font-bold text-white mb-4 flex items-center">
                                <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                                Mandar Boletos
                                <span class="ml-auto bg-blue-600 text-white text-xs px-2 py-1 rounded-full" id="mandarBoletosCount">0</span>
                            </h3>
                            <div id="mandarBoletosContainer" class="space-y-2 min-h-[300px] max-h-[500px] overflow-y-auto scrollbar-thin"></div>
                        </div>

                        <div class="bg-gray-800 rounded-xl border border-gray-700 p-4">
                            <h3 class="text-lg font-bold text-white mb-4 flex items-center">
                                <div class="w-3 h-3 bg-orange-500 rounded-full mr-2"></div>
                                Falta Pagamento
                                <span class="ml-auto bg-orange-600 text-white text-xs px-2 py-1 rounded-full" id="faltaPagamentoCount">0</span>
                            </h3>
                            <div id="faltaPagamentoContainer" class="space-y-2 min-h-[300px] max-h-[500px] overflow-y-auto scrollbar-thin"></div>
                        </div>

                        <div class="bg-gray-800 rounded-xl border border-gray-700 p-4">
                            <h3 class="text-lg font-bold text-white mb-4 flex items-center">
                                <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                                Pagamento Efetuado
                                <span class="ml-auto bg-green-600 text-white text-xs px-2 py-1 rounded-full" id="pagamentoEfetuadoCount">0</span>
                            </h3>
                            <div id="pagamentoEfetuadoContainer" class="space-y-2 min-h-[300px] max-h-[500px] overflow-y-auto scrollbar-thin"></div>
                        </div>
                    </div>
                </div>

                <!-- Kanban Indica√ß√µes Section -->
                <div id="kanban-indicacoes" class="section hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl md:text-3xl font-bold text-white mb-2">Kanban Indica√ß√µes</h2>
                        <p class="text-gray-400">Acompanhe o processo de indica√ß√µes</p>
                    </div>

                    <div class="mb-4">
                        <button onclick="showNovaIndicacaoModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition duration-200 flex items-center">
                            <i class="fas fa-plus mr-2"></i>Nova Indica√ß√£o
                        </button>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 md:gap-6">
                        <div class="bg-gray-800 rounded-xl border border-gray-700 p-4">
                            <h3 class="text-lg font-bold text-white mb-4 flex items-center">
                                <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                                Lead Novo
                                <span class="ml-auto bg-blue-600 text-white text-xs px-2 py-1 rounded-full" id="leadNovoCount">0</span>
                            </h3>
                            <div id="leadNovoContainer" class="space-y-2 min-h-[300px] max-h-[500px] overflow-y-auto scrollbar-thin"></div>
                        </div>

                        <div class="bg-gray-800 rounded-xl border border-gray-700 p-4">
                            <h3 class="text-lg font-bold text-white mb-4 flex items-center">
                                <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                                WhatsApp
                                <span class="ml-auto bg-green-600 text-white text-xs px-2 py-1 rounded-full" id="whatsappCount">0</span>
                            </h3>
                            <div id="whatsappContainer" class="space-y-2 min-h-[300px] max-h-[500px] overflow-y-auto scrollbar-thin"></div>
                        </div>

                        <div class="bg-gray-800 rounded-xl border border-gray-700 p-4">
                            <h3 class="text-lg font-bold text-white mb-4 flex items-center">
                                <div class="w-3 h-3 bg-yellow-500 rounded-full mr-2"></div>
                                Negociando
                                <span class="ml-auto bg-yellow-600 text-white text-xs px-2 py-1 rounded-full" id="negociandoCount">0</span>
                            </h3>
                            <div id="negociandoContainer" class="space-y-2 min-h-[300px] max-h-[500px] overflow-y-auto scrollbar-thin"></div>
                        </div>

                        <div class="bg-gray-800 rounded-xl border border-gray-700 p-4">
                            <h3 class="text-lg font-bold text-white mb-4 flex items-center">
                                <div class="w-3 h-3 bg-purple-500 rounded-full mr-2"></div>
                                Pedindo Dados
                                <span class="ml-auto bg-purple-600 text-white text-xs px-2 py-1 rounded-full" id="pedindoDadosCount">0</span>
                            </h3>
                            <div id="pedindoDadosContainer" class="space-y-2 min-h-[300px] max-h-[500px] overflow-y-auto scrollbar-thin"></div>
                        </div>
                    </div>
                </div>

                <!-- Indica√ß√µes Section -->
                <div id="indicacoes" class="section hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl md:text-3xl font-bold text-white mb-2">Indica√ß√µes</h2>
                        <p class="text-gray-400">Gerencie suas indica√ß√µes de clientes</p>
                    </div>
                    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-white">Lista de Indica√ß√µes</h3>
                            <button onclick="showNovaIndicacaoModal()" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition duration-200 flex items-center">
                                <i class="fas fa-plus mr-2"></i>Nova Indica√ß√£o
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-700">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Nome</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Telefone</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Ve√≠culo</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Vendedor</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Observa√ß√µes</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Status</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Data</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="indicacoesTableBody" class="divide-y divide-gray-700"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Vendas Section -->
                <div id="vendas" class="section hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl md:text-3xl font-bold text-white mb-2">Vendas</h2>
                        <p class="text-gray-400">Gerencie suas vendas realizadas</p>
                    </div>
                    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-white">Lista de Vendas</h3>
                            <button onclick="showNovaVendaModal()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg transition duration-200 flex items-center">
                                <i class="fas fa-plus mr-2"></i>Nova Venda
                            </button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-700">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Cliente</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Empresa</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Produto</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Vendedor</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Pr√™mio L√≠quido</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">% Comiss√£o</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Comiss√£o Total</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Comiss√£o Vendedor</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Status</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Data</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="vendasTableBody" class="divide-y divide-gray-700"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Outras se√ß√µes -->
                <div id="vendedores" class="section hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl md:text-3xl font-bold text-white mb-2">Vendedores</h2>
                        <p class="text-gray-400">Gerencie sua equipe de vendas</p>
                    </div>

                    <!-- Formul√°rio de Vendedor -->
                    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6 mb-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-white">Cadastrar/Editar Vendedor</h3>
                            <button onclick="resetVendedorForm()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition duration-200">
                                <i class="fas fa-plus mr-2"></i>Novo Vendedor
                            </button>
                        </div>
                        
                        <form id="vendedorForm" class="space-y-4">
                            <input type="hidden" id="vendedorId" value="">
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-gray-300 text-sm font-medium mb-2">Nome Completo *</label>
                                    <input type="text" id="vendedorNome" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" placeholder="Digite o nome completo" required>
                                </div>
                                
                                <div>
                                    <label class="block text-gray-300 text-sm font-medium mb-2">Usu√°rio *</label>
                                    <select id="vendedorUsuario" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" required>
                                        <option value="">Selecione um usu√°rio</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-gray-300 text-sm font-medium mb-2">Telefone *</label>
                                    <input type="tel" id="vendedorTelefone" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" placeholder="(11) 99999-9999" required>
                                </div>
                                
                                <div>
                                    <label class="block text-gray-300 text-sm font-medium mb-2">Meta do M√™s (R$) *</label>
                                    <input type="number" step="0.01" min="0" id="vendedorMeta" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" placeholder="0,00" required>
                                </div>
                                
                                <div>
                                    <label class="block text-gray-300 text-sm font-medium mb-2">% de Comiss√£o *</label>
                                    <input type="number" step="0.01" min="0" max="100" id="vendedorComissao" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" placeholder="0,00" required>
                                </div>
                                
                                <div>
                                    <label class="block text-gray-300 text-sm font-medium mb-2">Vendas do M√™s (Autom√°tico)</label>
                                    <input type="number" id="vendedorVendasMes" class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-gray-300 cursor-not-allowed" placeholder="0" readonly>
                                    <p class="text-gray-400 text-xs mt-1">Este campo √© atualizado automaticamente e zera todo m√™s</p>
                                </div>
                            </div>
                            
                            <div class="flex space-x-4 pt-4">
                                <button type="button" onclick="resetVendedorForm()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition duration-200">
                                    <i class="fas fa-times mr-2"></i>Cancelar
                                </button>
                                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition duration-200">
                                    <i class="fas fa-save mr-2"></i>Salvar Vendedor
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Lista de Vendedores -->
                    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6">
                        <h3 class="text-xl font-bold text-white mb-4">Lista de Vendedores</h3>
                        
                        <!-- Tabela de Vendedores -->
                        <div class="overflow-x-auto mb-6">
                            <table class="w-full">
                                <thead class="bg-gray-700">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Nome</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Usu√°rio</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Telefone</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Meta do M√™s</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">% Comiss√£o</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Vendas</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="vendedoresTableBody" class="divide-y divide-gray-700"></tbody>
                            </table>
                        </div>
                        
                        <!-- Cards de Vendedores -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="vendedoresList"></div>
                    </div>
                </div>

                <div id="comissao" class="section hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl md:text-3xl font-bold text-white mb-2">Comiss√£o</h2>
                        <p class="text-gray-400">Controle de comiss√µes dos vendedores</p>
                    </div>
                    
                    <!-- Resumo de Comiss√µes -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="bg-gradient-to-br from-green-900 to-blue-900 rounded-xl border border-green-600 p-6">
                            <div class="flex items-center mb-4">
                                <div class="bg-green-600 p-3 rounded-lg mr-4">
                                    <i class="fas fa-dollar-sign text-white text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-white">Total de Comiss√µes</h3>
                                    <p class="text-green-200 text-sm">Vendas com pagamento efetuado</p>
                                </div>
                            </div>
                            <div class="text-3xl font-bold text-white" id="totalComissaoGeral">R$ 0,00</div>
                        </div>
                        
                        <div class="bg-gradient-to-br from-purple-900 to-pink-900 rounded-xl border border-purple-600 p-6">
                            <div class="flex items-center mb-4">
                                <div class="bg-purple-600 p-3 rounded-lg mr-4">
                                    <i class="fas fa-chart-bar text-white text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-white">Total de Vendas</h3>
                                    <p class="text-purple-200 text-sm">Pagamentos efetuados</p>
                                </div>
                            </div>
                            <div class="text-3xl font-bold text-white" id="totalVendasComissao">0</div>
                        </div>
                    </div>
                    
                    <!-- Tabela de Comiss√µes -->
                    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-white">Lista de Comiss√µes</h3>
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-money-bill-wave text-green-500"></i>
                                <span class="text-green-400 font-medium" id="comissaoCount">0 comiss√µes</span>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-700">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Nome Completo</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Empresa</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Vendedor</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Comiss√£o Total</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Comiss√£o Vendedor</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Data</th>
                                    </tr>
                                </thead>
                                <tbody id="comissaoTableBody" class="divide-y divide-gray-700"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="cancelamentos" class="section hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl md:text-3xl font-bold text-white mb-2">Cancelamentos</h2>
                        <p class="text-gray-400">Gerencie cancelamentos de ap√≥lices</p>
                    </div>

                    <!-- Formul√°rio de Cancelamento -->
                    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6 mb-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-white">Registrar Cancelamento</h3>
                            <button onclick="resetCancelamentoForm()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition duration-200">
                                <i class="fas fa-plus mr-2"></i>Novo Cancelamento
                            </button>
                        </div>
                        
                        <form id="cancelamentoForm" class="space-y-4">
                            <input type="hidden" id="cancelamentoId" value="">
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-gray-300 text-sm font-medium mb-2">Nome Completo *</label>
                                    <input type="text" id="cancelamentoNome" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-red-500" placeholder="Digite o nome completo" required>
                                </div>
                                
                                <div>
                                    <label class="block text-gray-300 text-sm font-medium mb-2">Empresa *</label>
                                    <select id="cancelamentoEmpresa" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-red-500" required>
                                        <option value="">Selecione a empresa</option>
                                        <option value="Porto Seguro">Porto Seguro</option>
                                        <option value="Bradesco">Bradesco</option>
                                        <option value="Azul Seguros">Azul Seguros</option>
                                        <option value="Suhai">Suhai</option>
                                        <option value="Allianz">Allianz</option>
                                        <option value="Tokio Marine">Tokio Marine</option>
                                        <option value="HDI">HDI</option>
                                        <option value="Mapfre">Mapfre</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-gray-300 text-sm font-medium mb-2">Valor do Estorno (R$) *</label>
                                    <input type="number" step="0.01" min="0" id="cancelamentoValor" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-red-500" placeholder="0,00" required>
                                </div>
                            </div>
                            
                            <div class="flex space-x-4 pt-4">
                                <button type="button" onclick="resetCancelamentoForm()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition duration-200">
                                    <i class="fas fa-times mr-2"></i>Cancelar
                                </button>
                                <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg transition duration-200">
                                    <i class="fas fa-save mr-2"></i>Registrar Cancelamento
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Caixa de Resumo Sofisticada -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="bg-gradient-to-br from-red-900 to-pink-900 rounded-xl border border-red-600 p-6">
                            <div class="flex items-center mb-4">
                                <div class="bg-red-600 p-3 rounded-lg mr-4">
                                    <i class="fas fa-dollar-sign text-white text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-white">Total de Estornos</h3>
                                    <p class="text-red-200 text-sm">Valor total cancelado</p>
                                </div>
                            </div>
                            <div class="text-3xl font-bold text-white" id="totalEstornos">R$ 0,00</div>
                        </div>
                        
                        <div class="bg-gradient-to-br from-orange-900 to-red-900 rounded-xl border border-orange-600 p-6">
                            <div class="flex items-center mb-4">
                                <div class="bg-orange-600 p-3 rounded-lg mr-4">
                                    <i class="fas fa-times-circle text-white text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-white">Cancelamentos</h3>
                                    <p class="text-orange-200 text-sm">Quantidade total</p>
                                </div>
                            </div>
                            <div class="text-3xl font-bold text-white" id="totalCancelamentos">0</div>
                        </div>
                        
                        <div class="bg-gradient-to-br from-yellow-900 to-orange-900 rounded-xl border border-yellow-600 p-6">
                            <div class="flex items-center mb-4">
                                <div class="bg-yellow-600 p-3 rounded-lg mr-4">
                                    <i class="fas fa-chart-bar text-white text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-white">M√©dia por Cancelamento</h3>
                                    <p class="text-yellow-200 text-sm">Valor m√©dio</p>
                                </div>
                            </div>
                            <div class="text-3xl font-bold text-white" id="mediaCancelamentos">R$ 0,00</div>
                        </div>
                    </div>

                    <!-- Tabela de Cancelamentos -->
                    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-white">Lista de Cancelamentos</h3>
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-times-circle text-red-500"></i>
                                <span class="text-red-400 font-medium" id="cancelamentosCount">0 cancelamentos</span>
                            </div>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-700">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Nome Completo</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Empresa</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Valor do Estorno</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Data</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="cancelamentosTableBody" class="divide-y divide-gray-700"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="relatorios" class="section hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl md:text-3xl font-bold text-white mb-2">Relat√≥rios</h2>
                        <p class="text-gray-400">Relat√≥rios e an√°lises do neg√≥cio</p>
                    </div>
                    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6">
                        <p class="text-gray-400">Se√ß√£o em desenvolvimento...</p>
                    </div>
                </div>

                <div id="links-uteis" class="section hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl md:text-3xl font-bold text-white mb-2">Links √öteis</h2>
                        <p class="text-gray-400">Links importantes para o trabalho</p>
                    </div>

                    <!-- Formul√°rio de Links -->
                    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6 mb-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-white">Adicionar Novo Link</h3>
                            <button onclick="resetLinkForm()" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition duration-200">
                                <i class="fas fa-plus mr-2"></i>Novo Link
                            </button>
                        </div>
                        
                        <form id="linkForm" class="space-y-4">
                            <input type="hidden" id="linkId" value="">
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-gray-300 text-sm font-medium mb-2">Nome do Site *</label>
                                    <input type="text" id="linkNome" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" placeholder="Ex: Portal da Seguradora" required>
                                </div>
                                
                                <div>
                                    <label class="block text-gray-300 text-sm font-medium mb-2">URL *</label>
                                    <input type="url" id="linkUrl" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" placeholder="https://exemplo.com" required>
                                </div>
                            </div>
                            
                            <div class="flex space-x-4 pt-4">
                                <button type="button" onclick="resetLinkForm()" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg transition duration-200">
                                    <i class="fas fa-times mr-2"></i>Cancelar
                                </button>
                                <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition duration-200">
                                    <i class="fas fa-save mr-2"></i>Salvar Link
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Grid de Links -->
                    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-white">Links Salvos</h3>
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-link text-blue-500"></i>
                                <span class="text-blue-400 font-medium" id="linksCount">0 links</span>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4" id="linksGrid">
                            <!-- Links ser√£o inseridos aqui -->
                        </div>
                    </div>
                </div>

                <div id="sem-sucesso" class="section hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl md:text-3xl font-bold text-white mb-2">Sem Sucesso</h2>
                        <p class="text-gray-400">Leads que n√£o tiveram sucesso</p>
                    </div>
                    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-white">Lista de Leads Sem Sucesso</h3>
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-times-circle text-red-500"></i>
                                <span class="text-red-400 font-medium" id="semSucessoCount">0 leads</span>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-700">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Nome</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Telefone</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Ve√≠culo</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Vendedor</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Data Marca√ß√£o</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Motivo</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="semSucessoTableBody" class="divide-y divide-gray-700"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="lead-suhai" class="section hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl md:text-3xl font-bold text-white mb-2">Lead Suhai</h2>
                        <p class="text-gray-400">Leads espec√≠ficos da Suhai</p>
                    </div>
                    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6 mb-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-xl font-bold text-white">Lista de Leads Suhai</h3>
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-star text-purple-500"></i>
                                <span class="text-purple-400 font-medium" id="leadSuhaiCount">0 leads</span>
                            </div>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-700">
                                    <tr>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Nome Completo</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Vendedor</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Comiss√£o da Venda</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">Data</th>
                                        <th class="px-6 py-4 text-left text-gray-300 font-medium">A√ß√µes</th>
                                    </tr>
                                </thead>
                                <tbody id="leadSuhaiTableBody" class="divide-y divide-gray-700"></tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Summary and Ranking Section -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Total Summary -->
                        <div class="lg:col-span-2 bg-gradient-to-br from-purple-900 to-blue-900 rounded-xl border border-purple-600 p-6">
                            <div class="flex items-center mb-4">
                                <div class="bg-purple-600 p-3 rounded-lg mr-4">
                                    <i class="fas fa-chart-bar text-white text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-white">Resumo Total</h3>
                                    <p class="text-purple-200 text-sm">Leads Suhai - Performance Geral</p>
                                </div>
                            </div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-black bg-opacity-20 rounded-lg p-4 border border-purple-500">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-purple-200 text-sm font-medium">Total de Vendas</p>
                                            <p class="text-2xl font-bold text-white" id="totalVendasSuhai">0</p>
                                        </div>
                                        <div class="bg-purple-600 p-2 rounded-lg">
                                            <i class="fas fa-shopping-cart text-white"></i>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="bg-black bg-opacity-20 rounded-lg p-4 border border-green-500">
                                    <div class="flex items-center justify-between">
                                        <div>
                                            <p class="text-green-200 text-sm font-medium">Total Comiss√£o</p>
                                            <p class="text-2xl font-bold text-white" id="totalComissaoSuhai">R$ 0,00</p>
                                        </div>
                                        <div class="bg-green-600 p-2 rounded-lg">
                                            <i class="fas fa-dollar-sign text-white"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Top 3 Ranking -->
                        <div class="bg-gray-800 rounded-xl border border-gray-700 p-6">
                            <div class="flex items-center mb-4">
                                <div class="bg-yellow-600 p-2 rounded-lg mr-3">
                                    <i class="fas fa-trophy text-white"></i>
                                </div>
                                <div>
                                    <h3 class="text-lg font-bold text-white">Top 3 Vendedores</h3>
                                    <p class="text-gray-400 text-xs">Leads Suhai</p>
                                </div>
                            </div>
                            
                            <div class="space-y-3" id="rankingSuhai">
                                <!-- Ranking ser√° preenchido dinamicamente -->
                            </div>
                        </div>
                    </div>
                </div>

                <div id="configuracoes" class="section hidden">
                    <div class="mb-6">
                        <h2 class="text-2xl md:text-3xl font-bold text-white mb-2">Configura√ß√µes</h2>
                        <p class="text-gray-400">Configura√ß√µes do sistema</p>
                    </div>
                    
                    <!-- Status Firebase -->
                    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6 mb-6">
                        <div class="flex items-center mb-4">
                            <i class="fas fa-fire text-orange-500 mr-3"></i>
                            <h3 class="text-xl font-bold text-white">Status Firebase</h3>
                            <div id="firebaseStatus" class="ml-auto">
                                <span class="px-3 py-1 text-xs rounded-full bg-green-600 text-white">
                                    <i class="fas fa-check-circle mr-1"></i>Conectado
                                </span>
                            </div>
                        </div>
                        
                        <div class="bg-green-900 bg-opacity-30 p-4 rounded border border-green-600">
                            <div class="flex items-center mb-3">
                                <i class="fas fa-check-circle text-green-400 mr-2"></i>
                                <h4 class="text-lg font-bold text-green-400">‚úÖ Firebase Configurado com Sucesso!</h4>
                            </div>
                            
                            <div class="space-y-2 text-sm text-gray-300">
                                <p><strong>Projeto:</strong> vm-seguros-crm</p>
                                <p><strong>Database URL:</strong> https://vm-seguros-crm-default-rtdb.firebaseio.com</p>
                                <p><strong>Status:</strong> Realtime Database ativo e funcionando</p>
                                <p><strong>Funcionalidades:</strong> Sincroniza√ß√£o em tempo real, notifica√ß√µes push, presen√ßa online</p>
                            </div>
                        </div>
                        
                        <div class="mt-4 p-3 bg-blue-900 bg-opacity-30 rounded border border-blue-600">
                            <div class="flex items-center">
                                <i class="fas fa-info-circle text-blue-400 mr-2"></i>
                                <p class="text-blue-300 text-sm">
                                    <strong>Sistema 100% Funcional:</strong> Todas as funcionalidades em tempo real est√£o ativas. 
                                    Teste criando indica√ß√µes e vendas em abas diferentes para ver a sincroniza√ß√£o instant√¢nea!
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Debug Section -->
                    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6 mb-6">
                        <div class="flex items-center mb-4">
                            <i class="fas fa-bug text-red-500 mr-3"></i>
                            <h3 class="text-xl font-bold text-white">Debug - Credenciais do Sistema</h3>
                        </div>
                        
                        <div class="bg-gray-900 rounded-lg p-4 border border-gray-600">
                            <div class="mb-4">
                                <div class="flex items-center mb-3">
                                    <i class="fas fa-shield-alt text-red-400 mr-2"></i>
                                    <h4 class="text-lg font-bold text-red-400">ADMINISTRADOR</h4>
                                </div>
                                <div class="bg-red-900 bg-opacity-30 p-3 rounded border border-red-600">
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <span class="text-red-300 font-medium">Nome:</span>
                                            <p class="text-white">Admin</p>
                                        </div>
                                        <div>
                                            <span class="text-red-300 font-medium">Login:</span>
                                            <p class="text-white font-mono">admin</p>
                                        </div>
                                        <div>
                                            <span class="text-red-300 font-medium">Senha:</span>
                                            <p class="text-white font-mono">admin123</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <div class="flex items-center mb-3">
                                    <i class="fas fa-users text-blue-400 mr-2"></i>
                                    <h4 class="text-lg font-bold text-blue-400">VENDEDORES</h4>
                                </div>
                                <div class="space-y-3" id="debugVendedoresList">
                                    <!-- Vendedores ser√£o carregados aqui -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 p-3 bg-yellow-900 bg-opacity-30 rounded border border-yellow-600">
                            <div class="flex items-center">
                                <i class="fas fa-exclamation-triangle text-yellow-400 mr-2"></i>
                                <p class="text-yellow-300 text-sm">
                                    <strong>Aviso:</strong> Esta se√ß√£o √© apenas para debug e desenvolvimento. 
                                    Em produ√ß√£o, as credenciais devem ser protegidas adequadamente.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Outras configura√ß√µes -->
                    <div class="bg-gray-800 rounded-xl border border-gray-700 p-6">
                        <h3 class="text-xl font-bold text-white mb-4">Configura√ß√µes Gerais</h3>
                        <p class="text-gray-400">Outras configura√ß√µes em desenvolvimento...</p>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <div id="novaIndicacaoModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-gray-800 rounded-xl p-6 w-full max-w-4xl mx-4 border border-gray-700 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-white">Nova Indica√ß√£o</h3>
                <button onclick="closeModal('novaIndicacaoModal')" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="indicacaoForm" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <div>
                        <label class="block text-gray-300 text-sm font-medium mb-2">Nome do Cliente *</label>
                        <input type="text" id="indicacaoNome" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-gray-300 text-sm font-medium mb-2">Telefone *</label>
                        <input type="tel" id="indicacaoTelefone" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" placeholder="(11) 99999-9999" required>
                    </div>
                    <div>
                        <label class="block text-gray-300 text-sm font-medium mb-2">Ve√≠culo *</label>
                        <input type="text" id="indicacaoVeiculo" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" placeholder="Ex: Honda Civic 2020" required>
                    </div>
                    <div>
                        <label class="block text-gray-300 text-sm font-medium mb-2">Vendedor *</label>
                        <select id="indicacaoVendedor" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" required>
                            <option value="">Selecione um vendedor</option>
                        </select>
                    </div>
                </div>
                
                <div>
                    <label class="block text-gray-300 text-sm font-medium mb-2">Observa√ß√µes</label>
                    <textarea id="indicacaoObservacoes" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" rows="4" placeholder="Digite observa√ß√µes sobre o cliente, prefer√™ncias, hist√≥rico de contato, etc..."></textarea>
                    <p class="text-gray-400 text-xs mt-1">Informa√ß√µes adicionais que podem ajudar no atendimento</p>
                </div>
                
                <div class="flex space-x-4 pt-4">
                    <button type="button" onclick="closeModal('novaIndicacaoModal')" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg transition duration-200">
                        <i class="fas fa-times mr-2"></i>Cancelar
                    </button>
                    <button type="submit" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg transition duration-200">
                        <i class="fas fa-plus mr-2"></i>Adicionar Indica√ß√£o
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div id="novaVendaModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-gray-800 rounded-xl p-6 w-full max-w-4xl mx-4 border border-gray-700 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-white">Nova Venda</h3>
                <button onclick="closeModal('novaVendaModal')" class="text-gray-400 hover:text-white">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="vendaForm" class="space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-gray-300 text-sm font-medium mb-2">Nome Completo *</label>
                        <input type="text" id="vendaCliente" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-gray-300 text-sm font-medium mb-2">Empresa *</label>
                        <select id="vendaEmpresa" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" required>
                            <option value="">Selecione uma empresa</option>
                            <option value="Porto Seguro">Porto Seguro</option>
                            <option value="Bradesco">Bradesco</option>
                            <option value="Azul Seguros">Azul Seguros</option>
                            <option value="Suhai">Suhai</option>
                            <option value="Allianz">Allianz</option>
                            <option value="Tokio Marine">Tokio Marine</option>
                            <option value="HDI">HDI</option>
                            <option value="Mapfre">Mapfre</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-300 text-sm font-medium mb-2">Produto *</label>
                        <select id="vendaProduto" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" required>
                            <option value="">Selecione um produto</option>
                            <option value="Seguro Auto">Seguro Auto</option>
                            <option value="Seguro Residencial">Seguro Residencial</option>
                            <option value="Seguro Vida">Seguro Vida</option>
                            <option value="Seguro Empresarial">Seguro Empresarial</option>
                            <option value="Seguro Viagem">Seguro Viagem</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-300 text-sm font-medium mb-2">Vendedor *</label>
                        <select id="vendaVendedor" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" onchange="updateVendedorComissao()" required>
                            <option value="">Selecione um vendedor</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-300 text-sm font-medium mb-2">Pr√™mio L√≠quido (R$) *</label>
                        <input type="number" step="0.01" min="0" id="vendaPremio" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" oninput="calculateComissoes()" required>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-gray-300 text-sm font-medium mb-2">% de Comiss√£o da Venda *</label>
                        <input type="number" step="0.01" min="0" max="100" id="vendaPercentualComissao" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500" oninput="calculateComissoes()" placeholder="15.00" required>
                        <p class="text-gray-400 text-xs mt-1">% total da comiss√£o da empresa</p>
                    </div>
                    <div>
                        <label class="block text-gray-300 text-sm font-medium mb-2">Comiss√£o Total (R$)</label>
                        <input type="number" step="0.01" id="vendaComissaoTotal" class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-gray-300 cursor-not-allowed" readonly>
                        <p class="text-gray-400 text-xs mt-1">Calculado automaticamente</p>
                    </div>
                    <div>
                        <label class="block text-gray-300 text-sm font-medium mb-2">Comiss√£o Vendedor (R$)</label>
                        <input type="number" step="0.01" id="vendaComissaoVendedor" class="w-full px-4 py-3 bg-gray-600 border border-gray-500 rounded-lg text-gray-300 cursor-not-allowed" readonly>
                        <p class="text-gray-400 text-xs mt-1" id="vendaComissaoVendedorInfo">Baseado no % do vendedor</p>
                    </div>
                </div>
                
                <div class="flex space-x-4 pt-4">
                    <button type="button" onclick="closeModal('novaVendaModal')" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg transition duration-200">
                        <i class="fas fa-times mr-2"></i>Cancelar
                    </button>
                    <button type="submit" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg transition duration-200">
                        <i class="fas fa-plus mr-2"></i>Adicionar Venda
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Confirma√ß√£o Personalizado -->
    <div id="customConfirmModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-gray-800 rounded-xl p-6 w-full max-w-md mx-4 border border-gray-700">
            <div class="flex items-center mb-4">
                <div class="bg-yellow-600 p-3 rounded-full mr-4">
                    <i class="fas fa-question text-white text-xl"></i>
                </div>
                <h3 class="text-xl font-bold text-white" id="confirmTitle">Confirmar A√ß√£o</h3>
            </div>
            <p class="text-gray-300 mb-6" id="confirmMessage">Tem certeza que deseja continuar?</p>
            <div class="flex space-x-4">
                <button id="confirmCancel" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg transition duration-200">
                    <i class="fas fa-times mr-2"></i>Cancelar
                </button>
                <button id="confirmOk" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg transition duration-200">
                    <i class="fas fa-check mr-2"></i>Confirmar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Prompt Personalizado -->
    <div id="customPromptModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center">
        <div class="bg-gray-800 rounded-xl p-6 w-full max-w-md mx-4 border border-gray-700">
            <div class="flex items-center mb-4">
                <div class="bg-blue-600 p-3 rounded-full mr-4">
                    <i class="fas fa-edit text-white text-xl"></i>
                </div>
                <h3 class="text-xl font-bold text-white" id="promptTitle">Digite a Informa√ß√£o</h3>
            </div>
            <p class="text-gray-300 mb-4" id="promptMessage">Por favor, digite:</p>
            <textarea id="promptInput" class="w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-blue-500 mb-6" rows="4" placeholder="Digite aqui..."></textarea>
            <div class="flex space-x-4">
                <button id="promptCancel" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg transition duration-200">
                    <i class="fas fa-times mr-2"></i>Cancelar
                </button>
                <button id="promptOk" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg transition duration-200">
                    <i class="fas fa-check mr-2"></i>Confirmar
                </button>
            </div>
        </div>
    </div>

    <script>
        // ===== CONFIGURA√á√ÉO FIREBASE COM SUAS CREDENCIAIS REAIS =====
        const firebaseConfig = {
            apiKey: "AIzaSyDvlpoHOKyRXmNG3RVYiTspOQ3TxsHH03s",
            authDomain: "vm-seguros-crm.firebaseapp.com",
            databaseURL: "https://vm-seguros-crm-default-rtdb.firebaseio.com",
            projectId: "vm-seguros-crm",
            storageBucket: "vm-seguros-crm.firebasestorage.app",
            messagingSenderId: "420895990730",
            appId: "1:420895990730:web:f6c753d929d84b5330e533",
            measurementId: "G-V82V2HLX62"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();

        // ===== SISTEMA DE DADOS EM TEMPO REAL =====
        let currentUser = null;
        let isOnline = false;
        let lastActivity = Date.now();
        let heartbeatInterval = null;
        let dataListeners = {};

        // Dados locais (cache) - Inicializar com arrays vazios
        let indicacoes = [];
        let vendas = [];
        let vendedoresData = [];
        let notificacoes = [];
        let usuariosOnline = {};
        let leadsSuhai = [];
        let leadsSemSucesso = [];
        let comissoes = [];
        let cancelamentos = [];
        let linksUteis = [];

        const usuarios = [
            { id: 1, nome: 'Admin', login: 'admin', senha: 'admin123', tipo: 'admin' },
            { id: 2, nome: 'Igor Vicente', login: 'igor.vicente', senha: 'Realmadridfc12@', tipo: 'vendedor' },
            { id: 3, nome: 'Rodrigo Mariano', login: 'rodrigo', senha: 'ninjinha10', tipo: 'vendedor' },
            { id: 4, nome: 'Jessica Regis', login: 'jessica.regis', senha: 'jessica123', tipo: 'vendedor' },
            { id: 5, nome: 'Jaqueline Brito', login: 'jaqueline.brito', senha: 'jaque123', tipo: 'vendedor' },
            { id: 6, nome: 'Jessica Brito', login: 'jessica.brito', senha: 'jbrito123', tipo: 'vendedor' },
            { id: 7, nome: 'Luana Vieira', login: 'luana.vieira', senha: 'luana123', tipo: 'vendedor' },
            { id: 8, nome: 'Leonardo Ferreira', login: 'leonardo.ferreira', senha: 'leo123', tipo: 'vendedor' },
            { id: 9, nome: 'Ana Beatriz', login: 'ana.beatriz', senha: 'ana123', tipo: 'vendedor' },
            { id: 10, nome: 'Elen Jaconis', login: 'elen.jaconis', senha: 'elen123', tipo: 'vendedor' },
            { id: 11, nome: 'Usuario 1', login: 'usuario1', senha: 'user123', tipo: 'vendedor' }
        ];

        // ===== SISTEMA DE CONEX√ÉO EM TEMPO REAL =====
        class RealtimeSystem {
            constructor() {
                this.connectedRef = null;
                this.userPresenceRef = null;
                this.connectionRetryCount = 0;
                this.maxRetries = 3;
                this.setupConnectionMonitoring();
            }

            setupConnectionMonitoring() {
                try {
                    this.connectedRef = database.ref('.info/connected');
                    this.connectedRef.on('value', (snapshot) => {
                        if (snapshot.val() === true) {
                            console.log('üü¢ Conectado ao Firebase');
                            isOnline = true;
                            this.connectionRetryCount = 0;
                            this.updateConnectionStatus(true);
                            this.syncLocalData();
                        } else {
                            console.log('üî¥ Desconectado do Firebase');
                            isOnline = false;
                            this.updateConnectionStatus(false);
                            this.handleDisconnection();
                        }
                    }, (error) => {
                        console.error('‚ùå Erro na conex√£o Firebase:', error);
                        isOnline = false;
                        this.updateConnectionStatus(false);
                        this.retryConnection();
                    });
                } catch (error) {
                    console.error('‚ùå Erro ao configurar monitoramento de conex√£o:', error);
                    isOnline = false;
                    this.updateConnectionStatus(false);
                }
            }

            handleDisconnection() {
                // Trabalhar offline
                console.log('‚ö†Ô∏è Trabalhando offline - dados salvos localmente');
                createRealtimeNotification('warning', 'Modo Offline', 'Trabalhando offline. Dados ser√£o sincronizados quando a conex√£o retornar.');
            }

            retryConnection() {
                if (this.connectionRetryCount < this.maxRetries) {
                    this.connectionRetryCount++;
                    console.log(`üîÑ Tentativa de reconex√£o ${this.connectionRetryCount}/${this.maxRetries}`);
                    
                    setTimeout(() => {
                        try {
                            this.setupConnectionMonitoring();
                        } catch (error) {
                            console.error('‚ùå Erro na tentativa de reconex√£o:', error);
                        }
                    }, 5000 * this.connectionRetryCount); // Delay progressivo
                } else {
                    console.log('‚ùå M√°ximo de tentativas de reconex√£o atingido. Trabalhando offline.');
                    createRealtimeNotification('error', 'Conex√£o Perdida', 'N√£o foi poss√≠vel conectar ao servidor. Trabalhando offline.');
                }
            }

            updateConnectionStatus(connected) {
                const statusElement = document.getElementById('connectionStatus');
                if (statusElement) {
                    statusElement.innerHTML = connected 
                        ? '<i class="fas fa-wifi text-green-500"></i> Online'
                        : '<i class="fas fa-wifi text-red-500"></i> Offline';
                }
            }

            async setUserOnline(user) {
                if (!user) return;
                
                this.userPresenceRef = database.ref(`presence/${user.id}`);
                
                // Definir usu√°rio como online
                await this.userPresenceRef.set({
                    nome: user.nome,
                    login: user.login,
                    tipo: user.tipo,
                    lastSeen: firebase.database.ServerValue.TIMESTAMP,
                    online: true
                });

                // Remover quando desconectar
                this.userPresenceRef.onDisconnect().set({
                    nome: user.nome,
                    login: user.login,
                    tipo: user.tipo,
                    lastSeen: firebase.database.ServerValue.TIMESTAMP,
                    online: false
                });

                // Monitorar outros usu√°rios online
                this.monitorOnlineUsers();
            }

            monitorOnlineUsers() {
                database.ref('presence').on('value', (snapshot) => {
                    usuariosOnline = snapshot.val() || {};
                    this.updateOnlineUsersList();
                });
            }

            updateOnlineUsersList() {
                const onlineCount = Object.values(usuariosOnline).filter(u => u.online).length;
                const onlineElement = document.getElementById('onlineUsers');
                if (onlineElement) {
                    onlineElement.textContent = `${onlineCount} usu√°rios online`;
                }
            }

            async setUserOffline() {
                if (this.userPresenceRef) {
                    await this.userPresenceRef.update({
                        online: false,
                        lastSeen: firebase.database.ServerValue.TIMESTAMP
                    });
                }
            }

            syncLocalData() {
                // Sincronizar dados locais com Firebase quando conectar
                this.syncIndicacoes();
                this.syncVendas();
                this.syncVendedores();
                this.syncNotificacoes();
                this.syncLeadsSuhai();
                this.syncLeadsSemSucesso();
                this.syncComissoes();
                this.syncCancelamentos();
                this.syncLinksUteis();
            }

            async syncIndicacoes() {
                try {
                    // Enviar dados locais para Firebase
                    const localData = JSON.parse(localStorage.getItem('vmSegurosData') || '{}');
                    if (localData.indicacoes && localData.indicacoes.length > 0) {
                        for (const indicacao of localData.indicacoes) {
                            await database.ref(`indicacoes/${indicacao.id}`).set(indicacao);
                        }
                    }

                    // Escutar mudan√ßas em tempo real
                    database.ref('indicacoes').on('value', (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            indicacoes = Object.values(data);
                            updateIndicacoesTable();
                            updateKanbanIndicacoes();
                            updateDashboard();
                        }
                    });
                } catch (error) {
                    console.error('Erro ao sincronizar indica√ß√µes:', error);
                }
            }

            async syncVendas() {
                try {
                    const localData = JSON.parse(localStorage.getItem('vmSegurosData') || '{}');
                    if (localData.vendas && localData.vendas.length > 0) {
                        for (const venda of localData.vendas) {
                            await database.ref(`vendas/${venda.id}`).set(venda);
                        }
                    }

                    database.ref('vendas').on('value', (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            vendas = Object.values(data);
                            updateVendasTable();
                            updateKanbanVendas();
                            updateDashboard();
                            updateVendedoresList();
                        }
                    });
                } catch (error) {
                    console.error('Erro ao sincronizar vendas:', error);
                }
            }

            async syncVendedores() {
                try {
                    const localData = JSON.parse(localStorage.getItem('vmSegurosData') || '{}');
                    if (localData.vendedoresData && localData.vendedoresData.length > 0) {
                        for (const vendedor of localData.vendedoresData) {
                            await database.ref(`vendedores/${vendedor.id}`).set(vendedor);
                        }
                    }

                    database.ref('vendedores').on('value', (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            vendedoresData = Object.values(data);
                            updateVendedoresList();
                            updateVendedoresTable();
                            populateVendedorSelects();
                        }
                    });
                } catch (error) {
                    console.error('Erro ao sincronizar vendedores:', error);
                }
            }

            async syncNotificacoes() {
                if (!currentUser) return;

                // Escutar notifica√ß√µes para o usu√°rio atual
                database.ref(`notificacoes/${currentUser.id}`).on('child_added', (snapshot) => {
                    const notificacao = snapshot.val();
                    if (notificacao && notificacao.timestamp > lastActivity) {
                        this.showRealtimeNotification(notificacao);
                        
                        // Marcar como lida ap√≥s 5 segundos
                        setTimeout(() => {
                            database.ref(`notificacoes/${currentUser.id}/${snapshot.key}`).update({
                                lida: true
                            });
                        }, 5000);
                    }
                });
            }

            showRealtimeNotification(notificacao) {
                // Som de notifica√ß√£o
                this.playNotificationSound();
                
                // Notifica√ß√£o visual
                createRealtimeNotification(
                    notificacao.tipo || 'info',
                    notificacao.titulo,
                    notificacao.mensagem
                );

                // Notifica√ß√£o do navegador (se permitido)
                if (Notification.permission === 'granted') {
                    new Notification(notificacao.titulo, {
                        body: notificacao.mensagem,
                        icon: '/favicon.ico'
                    });
                }
            }

            async syncLeadsSuhai() {
                try {
                    database.ref('leadsSuhai').on('value', (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            leadsSuhai = Object.values(data);
                            updateLeadSuhaiTable();
                        }
                    });
                } catch (error) {
                    console.error('Erro ao sincronizar leads Suhai:', error);
                }
            }

            async syncLeadsSemSucesso() {
                try {
                    database.ref('leadsSemSucesso').on('value', (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            leadsSemSucesso = Object.values(data);
                            updateSemSucessoTable();
                        }
                    });
                } catch (error) {
                    console.error('Erro ao sincronizar leads sem sucesso:', error);
                }
            }

            async syncComissoes() {
                try {
                    database.ref('comissoes').on('value', (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            comissoes = Object.values(data);
                            updateComissaoTable();
                        }
                    });
                } catch (error) {
                    console.error('Erro ao sincronizar comiss√µes:', error);
                }
            }

            async syncCancelamentos() {
                try {
                    database.ref('cancelamentos').on('value', (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            cancelamentos = Object.values(data);
                            updateCancelamentosTable();
                        }
                    });
                } catch (error) {
                    console.error('Erro ao sincronizar cancelamentos:', error);
                }
            }

            async syncLinksUteis() {
                try {
                    // Carregar dados locais primeiro
                    const localData = JSON.parse(localStorage.getItem('vmSegurosData') || '{}');
                    if (localData.linksUteis && localData.linksUteis.length > 0) {
                        console.log('üì§ Sincronizando links locais para Firebase...');
                        for (const link of localData.linksUteis) {
                            try {
                                await database.ref(`linksUteis/${link.id}`).set(link);
                            } catch (syncError) {
                                console.error('Erro ao sincronizar link individual:', syncError);
                            }
                        }
                    }

                    // Escutar mudan√ßas em tempo real
                    database.ref('linksUteis').on('value', (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            linksUteis = Object.values(data);
                            console.log('üì• Links carregados do Firebase:', linksUteis.length);
                        } else {
                            linksUteis = [];
                            console.log('üì• Nenhum link encontrado no Firebase');
                        }
                        updateLinksGrid();
                    }, (error) => {
                        console.error('Erro ao escutar mudan√ßas nos links:', error);
                        // Carregar dados locais como fallback
                        const localData = JSON.parse(localStorage.getItem('vmSegurosData') || '{}');
                        linksUteis = localData.linksUteis || [];
                        updateLinksGrid();
                    });
                } catch (error) {
                    console.error('Erro ao sincronizar links √∫teis:', error);
                    // Carregar dados locais como fallback
                    try {
                        const localData = JSON.parse(localStorage.getItem('vmSegurosData') || '{}');
                        linksUteis = localData.linksUteis || [];
                        console.log('üì± Carregando links do cache local:', linksUteis.length);
                    } catch (localError) {
                        console.error('Erro ao carregar dados locais:', localError);
                        linksUteis = [];
                    }
                    updateLinksGrid();
                }
            }

            playNotificationSound() {
                try {
                    const audio = new Audio('data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmGgU7k9n1unEiBC13yO/eizEIHWq+8+OWT');
                    audio.volume = 0.3;
                    audio.play().catch(() => {}); // Ignorar erros de autoplay
                } catch (error) {
                    console.log('N√£o foi poss√≠vel reproduzir som de notifica√ß√£o');
                }
            }
        }

        // Inst√¢ncia do sistema em tempo real
        const realtimeSystem = new RealtimeSystem();

        // ===== SISTEMA DE LOGIN E INICIALIZA√á√ÉO =====
        document.addEventListener('DOMContentLoaded', function() {
            // Solicitar permiss√£o para notifica√ß√µes
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }

            document.getElementById('loginForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value;
                
                const user = usuarios.find(u => u.login.toLowerCase() === username.toLowerCase() && u.senha === password);
                
                if (user) {
                    currentUser = user;
                    lastActivity = Date.now();
                    
                    // Salvar sess√£o no localStorage
                    localStorage.setItem('currentUserSession', JSON.stringify({
                        user: user,
                        loginTime: Date.now(),
                        lastActivity: Date.now()
                    }));
                    
                    document.getElementById('currentUser').textContent = user.nome;
                    document.getElementById('loginScreen').classList.add('hidden');
                    document.getElementById('crmSystem').classList.remove('hidden');
                    
                    // Definir usu√°rio como online no Firebase
                    try {
                        await realtimeSystem.setUserOnline(user);
                    } catch (error) {
                        console.error('Erro ao definir usu√°rio online:', error);
                    }
                    
                    // Inicializar sistema
                    await initializeSystem();
                    showSection('dashboard', document.querySelector('[onclick*="dashboard"]'));
                    
                    // Criar notifica√ß√£o de login
                    try {
                        await sendRealtimeNotification(null, {
                            tipo: 'info',
                            titulo: 'Usu√°rio Conectado',
                            mensagem: `${user.nome} entrou no sistema`,
                            broadcast: true
                        });
                    } catch (error) {
                        console.error('Erro ao enviar notifica√ß√£o de login:', error);
                    }
                    
                } else {
                    alert('Usu√°rio ou senha incorretos!');
                }
            });

            // Verificar se h√° sess√£o ativa
            checkExistingSession();

            initializeModalForms();
            
            // Monitorar atividade do usu√°rio
            document.addEventListener('click', () => {
                lastActivity = Date.now();
                updateSessionActivity();
            });
            document.addEventListener('keypress', () => {
                lastActivity = Date.now();
                updateSessionActivity();
            });
            
            // Cleanup ao fechar a p√°gina
            window.addEventListener('beforeunload', async () => {
                if (currentUser) {
                    try {
                        await realtimeSystem.setUserOffline();
                    } catch (error) {
                        console.error('Erro ao definir usu√°rio offline:', error);
                    }
                }
            });
        });

        function checkExistingSession() {
            try {
                const session = localStorage.getItem('currentUserSession');
                if (session) {
                    const sessionData = JSON.parse(session);
                    const now = Date.now();
                    const sessionAge = now - sessionData.loginTime;
                    const maxSessionAge = 24 * 60 * 60 * 1000; // 24 horas
                    
                    if (sessionAge < maxSessionAge) {
                        // Restaurar sess√£o
                        currentUser = sessionData.user;
                        lastActivity = sessionData.lastActivity;
                        
                        document.getElementById('currentUser').textContent = currentUser.nome;
                        document.getElementById('loginScreen').classList.add('hidden');
                        document.getElementById('crmSystem').classList.remove('hidden');
                        
                        // Inicializar sistema
                        initializeSystem().then(() => {
                            showSection('dashboard', document.querySelector('[onclick*="dashboard"]'));
                        });
                        
                        console.log('Sess√£o restaurada para:', currentUser.nome);
                    } else {
                        // Sess√£o expirada
                        localStorage.removeItem('currentUserSession');
                    }
                }
            } catch (error) {
                console.error('Erro ao verificar sess√£o existente:', error);
                localStorage.removeItem('currentUserSession');
            }
        }

        function updateSessionActivity() {
            if (currentUser) {
                try {
                    const session = localStorage.getItem('currentUserSession');
                    if (session) {
                        const sessionData = JSON.parse(session);
                        sessionData.lastActivity = Date.now();
                        localStorage.setItem('currentUserSession', JSON.stringify(sessionData));
                    }
                } catch (error) {
                    console.error('Erro ao atualizar atividade da sess√£o:', error);
                }
            }
        }

        async function initializeSystem() {
            try {
                // Carregar dados do Firebase
                await loadFirebaseData();
                
                // Inicializar componentes
                initializeDragAndDrop();
                updateDashboard();
                updateKanbanVendas();
                updateKanbanIndicacoes();
                updateIndicacoesTable();
                updateVendasTable();
                populateVendedorSelects();
                updateVendedoresList();
                updateVendedoresTable();
                populateVendedorUsuarioSelect();
                initializeVendedorForm();
                updateDebugCredentials();
                updateLeadSuhaiTable();
                updateSemSucessoTable();
                updateComissaoTable();
                initializeCancelamentoForm();
                updateCancelamentosTable();
                initializeLinkForm();
                updateLinksGrid();
                updateMonthlySalesCount();
                
                console.log('‚úÖ Sistema inicializado com sucesso');
            } catch (error) {
                console.error('‚ùå Erro ao inicializar sistema:', error);
                createRealtimeNotification('error', 'Erro de Conex√£o', 'N√£o foi poss√≠vel conectar ao servidor. Trabalhando offline.');
            }
        }

        async function loadFirebaseData() {
            try {
                // Carregar indica√ß√µes
                const indicacoesSnapshot = await database.ref('indicacoes').once('value');
                if (indicacoesSnapshot.exists()) {
                    indicacoes = Object.values(indicacoesSnapshot.val());
                }

                // Carregar vendas
                const vendasSnapshot = await database.ref('vendas').once('value');
                if (vendasSnapshot.exists()) {
                    vendas = Object.values(vendasSnapshot.val());
                }

                // Carregar vendedores
                const vendedoresSnapshot = await database.ref('vendedores').once('value');
                if (vendedoresSnapshot.exists()) {
                    vendedoresData = Object.values(vendedoresSnapshot.val());
                }

                // Carregar leads Suhai
                const leadsSuhaiSnapshot = await database.ref('leadsSuhai').once('value');
                if (leadsSuhaiSnapshot.exists()) {
                    leadsSuhai = Object.values(leadsSuhaiSnapshot.val());
                }

                // Carregar leads sem sucesso
                const leadsSemSucessoSnapshot = await database.ref('leadsSemSucesso').once('value');
                if (leadsSemSucessoSnapshot.exists()) {
                    leadsSemSucesso = Object.values(leadsSemSucessoSnapshot.val());
                }

                // Carregar comiss√µes
                const comissoesSnapshot = await database.ref('comissoes').once('value');
                if (comissoesSnapshot.exists()) {
                    comissoes = Object.values(comissoesSnapshot.val());
                }

                // Carregar cancelamentos
                const cancelamentosSnapshot = await database.ref('cancelamentos').once('value');
                if (cancelamentosSnapshot.exists()) {
                    cancelamentos = Object.values(cancelamentosSnapshot.val());
                }

                // Carregar links √∫teis
                const linksSnapshot = await database.ref('linksUteis').once('value');
                if (linksSnapshot.exists()) {
                    linksUteis = Object.values(linksSnapshot.val());
                }

                console.log('üìä Dados carregados do Firebase');
            } catch (error) {
                console.error('Erro ao carregar dados do Firebase:', error);
                // Carregar dados locais como fallback
                loadLocalData();
            }
        }

        function loadLocalData() {
            try {
                const data = localStorage.getItem('vmSegurosData');
                if (data) {
                    const parsed = JSON.parse(data);
                    indicacoes = parsed.indicacoes || [];
                    vendas = parsed.vendas || [];
                    vendedoresData = parsed.vendedoresData || [];
                    leadsSuhai = parsed.leadsSuhai || [];
                    leadsSemSucesso = parsed.leadsSemSucesso || [];
                    comissoes = parsed.comissoes || [];
                    cancelamentos = parsed.cancelamentos || [];
                    linksUteis = parsed.linksUteis || [];
                    console.log('üì± Dados carregados do cache local:', parsed);
                } else {
                    console.log('üì± Nenhum dado local encontrado, iniciando com arrays vazios');
                    indicacoes = [];
                    vendas = [];
                    vendedoresData = [];
                    leadsSuhai = [];
                    leadsSemSucesso = [];
                    comissoes = [];
                    cancelamentos = [];
                    linksUteis = [];
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados locais:', error);
                // Inicializar com arrays vazios em caso de erro
                indicacoes = [];
                vendas = [];
                vendedoresData = [];
                leadsSuhai = [];
                leadsSemSucesso = [];
                comissoes = [];
                cancelamentos = [];
                linksUteis = [];
            }
        }

        function showSection(sectionId, element = null) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Se element foi passado, usar ele, sen√£o tentar pegar do event
            const targetElement = element || (window.event && window.event.target);
            if (targetElement) {
                targetElement.classList.add('active');
            }
        }

        function toggleMobileMenu() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobileOverlay');
            
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        }

        async function logout() {
            if (currentUser) {
                try {
                    // Notificar logout
                    await sendRealtimeNotification(null, {
                        tipo: 'info',
                        titulo: 'Usu√°rio Desconectado',
                        mensagem: `${currentUser.nome} saiu do sistema`,
                        broadcast: true
                    });
                    
                    // Definir usu√°rio como offline
                    await realtimeSystem.setUserOffline();
                } catch (error) {
                    console.error('Erro ao fazer logout:', error);
                }
            }
            
            // Limpar sess√£o
            localStorage.removeItem('currentUserSession');
            
            currentUser = null;
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('crmSystem').classList.add('hidden');
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        function updateDashboard() {
            const hoje = new Date().toLocaleDateString('pt-BR');
            
            const leadsHoje = indicacoes.filter(i => i.data === hoje).length;
            const vendasHoje = vendas.filter(v => v.data === hoje).length;
            
            const premioHoje = vendas
                .filter(v => v.data === hoje)
                .reduce((sum, v) => sum + v.premioLiquido, 0);
            
            const premioMes = vendas
                .filter(v => {
                    const vendaDate = new Date(v.data.split('/').reverse().join('-'));
                    const currentDate = new Date();
                    return vendaDate.getMonth() === currentDate.getMonth() && 
                           vendaDate.getFullYear() === currentDate.getFullYear();
                })
                .reduce((sum, v) => sum + v.premioLiquido, 0);
            
            document.getElementById('leadsDoDia').textContent = leadsHoje;
            document.getElementById('vendasDoDia').textContent = vendasHoje;
            document.getElementById('premioLiquidoDia').textContent = `R$ ${premioHoje.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
            document.getElementById('premioLiquidoMes').textContent = `R$ ${premioMes.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
        }

        function updateKanbanVendas() {
            const containers = {
                'Fazer Vistoria': document.getElementById('fazerVistoriaContainer'),
                'Mandar Boletos': document.getElementById('mandarBoletosContainer'),
                'Falta Pagamento': document.getElementById('faltaPagamentoContainer'),
                'Pagamento Efetuado': document.getElementById('pagamentoEfetuadoContainer')
            };

            const counts = {
                'Fazer Vistoria': document.getElementById('fazerVistoriaCount'),
                'Mandar Boletos': document.getElementById('mandarBoletosCount'),
                'Falta Pagamento': document.getElementById('faltaPagamentoCount'),
                'Pagamento Efetuado': document.getElementById('pagamentoEfetuadoCount')
            };

            Object.keys(containers).forEach(status => {
                const container = containers[status];
                const count = counts[status];
                const vendasStatus = vendas.filter(v => v.status === status);
                
                container.innerHTML = '';
                count.textContent = vendasStatus.length;
                
                vendasStatus.forEach(venda => {
                    const card = document.createElement('div');
                    card.className = 'kanban-card bg-gray-700 p-3 rounded-lg border border-gray-600';
                    card.draggable = true;
                    card.dataset.id = venda.id;
                    card.dataset.type = 'venda';
                    
                    card.addEventListener('dragstart', (e) => handleDragStart(e, 'venda', venda.id));
                    card.addEventListener('dragend', handleDragEnd);
                    
                    card.innerHTML = `
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="font-medium text-white text-sm flex-1">${venda.cliente}</h4>
                            <div class="flex space-x-1 ml-2">
                                <button onclick="editarVenda(${venda.id})" class="text-blue-400 hover:text-blue-300 text-xs">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="excluirVenda(${venda.id})" class="text-red-400 hover:text-red-300 text-xs">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <p class="text-gray-300 text-xs mb-1">${venda.produto} - ${venda.empresa}</p>
                        <p class="text-gray-400 text-xs mb-2">${venda.vendedor}</p>
                        <p class="text-green-400 text-xs font-medium">R$ ${venda.premioLiquido.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p>
                        <div class="mt-3">
                            <!-- Lead Suhai Checkbox -->
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center space-x-2">
                                    <label class="flex items-center cursor-pointer">
                                        <input type="checkbox" ${venda.leadSuhai ? 'checked' : ''} onchange="toggleLeadSuhai(${venda.id})" class="sr-only">
                                        <div class="relative">
                                            <div class="w-4 h-4 bg-gray-600 rounded border border-gray-500 transition-all duration-200 ${venda.leadSuhai ? 'bg-purple-600 border-purple-500' : ''}"></div>
                                            ${venda.leadSuhai ? '<i class="fas fa-check absolute top-0 left-0 w-4 h-4 text-white text-xs flex items-center justify-center"></i>' : ''}
                                        </div>
                                    </label>
                                    <span class="text-purple-400 text-xs font-medium">Lead Suhai</span>
                                </div>
                                <span class="text-gray-500 text-xs">${venda.data}</span>
                            </div>
                            
                            <!-- Navigation Buttons -->
                            <div class="flex items-center justify-center space-x-1">
                                ${getKanbanNavigationButtons(venda.status, venda.id)}
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                });
            });
        }

        function updateKanbanIndicacoes() {
            const containers = {
                'Lead Novo': document.getElementById('leadNovoContainer'),
                'WhatsApp': document.getElementById('whatsappContainer'),
                'Negociando': document.getElementById('negociandoContainer'),
                'Pedindo Dados': document.getElementById('pedindoDadosContainer')
            };

            const counts = {
                'Lead Novo': document.getElementById('leadNovoCount'),
                'WhatsApp': document.getElementById('whatsappCount'),
                'Negociando': document.getElementById('negociandoCount'),
                'Pedindo Dados': document.getElementById('pedindoDadosCount')
            };

            Object.keys(containers).forEach(status => {
                const container = containers[status];
                const count = counts[status];
                const indicacoesStatus = indicacoes.filter(i => i.status === status);
                
                container.innerHTML = '';
                count.textContent = indicacoesStatus.length;
                
                indicacoesStatus.forEach(indicacao => {
                    const card = document.createElement('div');
                    card.className = 'kanban-card bg-gray-700 p-3 rounded-lg border border-gray-600';
                    card.draggable = true;
                    card.dataset.id = indicacao.id;
                    card.dataset.type = 'indicacao';
                    
                    card.addEventListener('dragstart', (e) => handleDragStart(e, 'indicacao', indicacao.id));
                    card.addEventListener('dragend', handleDragEnd);
                    
                    card.innerHTML = `
                        <div class="card-actions">
                            <button onclick="editarIndicacao(${indicacao.id})" class="text-blue-400 hover:text-blue-300 text-xs mr-1">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="excluirIndicacao(${indicacao.id})" class="text-red-400 hover:text-red-300 text-xs">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                        
                        <h4 class="font-medium text-white text-sm mb-2 pr-8">${indicacao.nome}</h4>
                        <p class="text-gray-300 text-xs mb-1">${indicacao.telefone}</p>
                        <p class="text-gray-300 text-xs mb-1">${indicacao.veiculo}</p>
                        <p class="text-gray-400 text-xs mb-3">${indicacao.vendedor}</p>
                        
                        <!-- Checkbox N√£o Atendeu -->
                        <div class="mb-2 flex items-center space-x-2">
                            <label class="flex items-center cursor-pointer">
                                <input type="checkbox" ${indicacao.naoAtendeu ? 'checked' : ''} onchange="toggleNaoAtendeu(${indicacao.id})" class="sr-only">
                                <div class="relative">
                                    <div class="w-4 h-4 bg-gray-600 rounded border border-gray-500 transition-all duration-200 ${indicacao.naoAtendeu ? 'bg-red-600 border-red-500' : ''}"></div>
                                    ${indicacao.naoAtendeu ? '<i class="fas fa-check absolute top-0 left-0 w-4 h-4 text-white text-xs flex items-center justify-center"></i>' : ''}
                                </div>
                            </label>
                            <span class="text-red-400 text-xs font-medium">N√£o Atendeu</span>
                        </div>
                        
                        <!-- Bot√µes de A√ß√£o -->
                        <div class="mb-3 space-y-1">
                            <button onclick="console.log('üîÑ Clicando CONVERTER para:', '${indicacao.id}', typeof '${indicacao.id}'); converterIndicacao('${indicacao.id}')" class="w-full bg-green-600 hover:bg-green-700 text-white text-xs py-1.5 px-2 rounded transition duration-200 flex items-center justify-center">
                                <i class="fas fa-exchange-alt mr-1"></i>CONVERTER
                            </button>
                            <button onclick="console.log('‚ùå Clicando SEM SUCESSO para:', '${indicacao.id}', typeof '${indicacao.id}'); marcarSemSucesso('${indicacao.id}')" class="w-full bg-red-600 hover:bg-red-700 text-white text-xs py-1.5 px-2 rounded transition duration-200 flex items-center justify-center">
                                <i class="fas fa-times mr-1"></i>SEM SUCESSO
                            </button>
                        </div>
                        
                        <div class="flex items-center justify-between">
                            <span class="text-gray-500 text-xs">${indicacao.data}</span>
                        </div>
                    `;
                    container.appendChild(card);
                });
            });
        }

        function updateIndicacoesTable() {
            const tbody = document.getElementById('indicacoesTableBody');
            tbody.innerHTML = '';
            
            indicacoes.forEach(indicacao => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-700';
                row.innerHTML = `
                    <td class="px-6 py-4 text-white">${indicacao.nome}</td>
                    <td class="px-6 py-4 text-gray-300">${indicacao.telefone}</td>
                    <td class="px-6 py-4 text-gray-300">${indicacao.veiculo}</td>
                    <td class="px-6 py-4 text-gray-300">${indicacao.vendedor}</td>
                    <td class="px-6 py-4 text-gray-300 max-w-xs truncate" title="${indicacao.observacoes || 'Sem observa√ß√µes'}">${indicacao.observacoes || 'Sem observa√ß√µes'}</td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 text-xs rounded-full bg-blue-600 text-white">${indicacao.status}</span>
                    </td>
                    <td class="px-6 py-4 text-gray-300">${indicacao.data}</td>
                    <td class="px-6 py-4">
                        <button onclick="editarIndicacao(${indicacao.id})" class="text-blue-400 hover:text-blue-300 mr-2">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="excluirIndicacao(${indicacao.id})" class="text-red-400 hover:text-red-300">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateVendasTable() {
            const tbody = document.getElementById('vendasTableBody');
            tbody.innerHTML = '';
            
            vendas.forEach(venda => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-700';
                row.innerHTML = `
                    <td class="px-6 py-4 text-white">${venda.cliente}</td>
                    <td class="px-6 py-4 text-gray-300">${venda.empresa}</td>
                    <td class="px-6 py-4 text-gray-300">${venda.produto}</td>
                    <td class="px-6 py-4 text-gray-300">${venda.vendedor}</td>
                    <td class="px-6 py-4 text-green-400">R$ ${venda.premioLiquido.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                    <td class="px-6 py-4 text-blue-400">${venda.percentualComissao || 15}%</td>
                    <td class="px-6 py-4 text-purple-400">R$ ${(venda.comissaoTotal || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                    <td class="px-6 py-4 text-yellow-400">R$ ${(venda.comissaoVendedor || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                    <td class="px-6 py-4">
                        <span class="px-2 py-1 text-xs rounded-full bg-yellow-600 text-white">${venda.status}</span>
                    </td>
                    <td class="px-6 py-4 text-gray-300">${venda.data}</td>
                    <td class="px-6 py-4">
                        <button onclick="editarVenda(${venda.id})" class="text-blue-400 hover:text-blue-300 mr-2">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="excluirVenda(${venda.id})" class="text-red-400 hover:text-red-300">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateVendedoresList() {
            const vendedoresList = document.getElementById('vendedoresList');
            if (!vendedoresList) return;
            
            vendedoresList.innerHTML = '';
            
            vendedoresData.forEach(vendedor => {
                const vendasVendedor = vendas.filter(v => v.vendedor === vendedor.nome);
                const totalVendas = vendasVendedor.length;
                const totalPremio = vendasVendedor.reduce((sum, v) => sum + v.premioLiquido, 0);
                const percentualMeta = vendedor.metaMes > 0 ? (totalPremio / vendedor.metaMes * 100) : 0;
                
                const card = document.createElement('div');
                card.className = 'bg-gray-700 p-4 rounded-lg border border-gray-600 hover-scale';
                card.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center">
                            <div class="bg-blue-600 w-10 h-10 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-user text-white"></i>
                            </div>
                            <div>
                                <h4 class="font-medium text-white">${vendedor.nome}</h4>
                                <p class="text-gray-400 text-sm">@${vendedor.usuario}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <button onclick="editarVendedorData(${vendedor.id})" class="text-blue-400 hover:text-blue-300 text-sm mr-2">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="excluirVendedorData(${vendedor.id})" class="text-red-400 hover:text-red-300 text-sm">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-gray-400 text-sm">Telefone:</span>
                            <span class="text-white text-sm">${vendedor.telefone}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400 text-sm">Vendas:</span>
                            <span class="text-white font-medium">${totalVendas}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400 text-sm">Pr√™mio Total:</span>
                            <span class="text-green-400 font-medium">R$ ${totalPremio.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400 text-sm">Meta do M√™s:</span>
                            <span class="text-yellow-400 font-medium">R$ ${vendedor.metaMes.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-400 text-sm">% Comiss√£o:</span>
                            <span class="text-purple-400 font-medium">${vendedor.comissao}%</span>
                        </div>
                        <div class="mt-3">
                            <div class="flex justify-between text-sm mb-1">
                                <span class="text-gray-400">Meta Atingida:</span>
                                <span class="text-white">${percentualMeta.toFixed(1)}%</span>
                            </div>
                            <div class="w-full bg-gray-600 rounded-full h-2">
                                <div class="bg-gradient-to-r from-blue-600 to-green-600 h-2 rounded-full" style="width: ${Math.min(percentualMeta, 100)}%"></div>
                            </div>
                        </div>
                    </div>
                `;
                vendedoresList.appendChild(card);
            });
        }

        function updateVendedoresTable() {
            const tbody = document.getElementById('vendedoresTableBody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            vendedoresData.forEach(vendedor => {
                const vendasVendedor = vendas.filter(v => v.vendedor === vendedor.nome);
                const totalVendas = vendasVendedor.length;
                const totalPremio = vendasVendedor.reduce((sum, v) => sum + v.premioLiquido, 0);
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-700';
                row.innerHTML = `
                    <td class="px-6 py-4 text-white">${vendedor.nome}</td>
                    <td class="px-6 py-4 text-gray-300">@${vendedor.usuario}</td>
                    <td class="px-6 py-4 text-gray-300">${vendedor.telefone}</td>
                    <td class="px-6 py-4 text-yellow-400">R$ ${vendedor.metaMes.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                    <td class="px-6 py-4 text-purple-400">${vendedor.comissao}%</td>
                    <td class="px-6 py-4">
                        <div class="text-white font-medium">${totalVendas} vendas</div>
                        <div class="text-green-400 text-sm">R$ ${totalPremio.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div>
                    </td>
                    <td class="px-6 py-4">
                        <button onclick="editarVendedorData(${vendedor.id})" class="text-blue-400 hover:text-blue-300 mr-2">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="excluirVendedorData(${vendedor.id})" class="text-red-400 hover:text-red-300">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function populateVendedorUsuarioSelect() {
            const select = document.getElementById('vendedorUsuario');
            if (!select) return;
            
            const vendedores = usuarios.filter(u => u.tipo === 'vendedor');
            select.innerHTML = '<option value="">Selecione um usu√°rio</option>';
            
            vendedores.forEach(vendedor => {
                const option = document.createElement('option');
                option.value = vendedor.login;
                option.textContent = `${vendedor.nome} (@${vendedor.login})`;
                select.appendChild(option);
            });
        }

        function initializeVendedorForm() {
            const form = document.getElementById('vendedorForm');
            if (!form) return;
            
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                const id = document.getElementById('vendedorId').value;
                const vendedorData = {
                    nome: document.getElementById('vendedorNome').value,
                    usuario: document.getElementById('vendedorUsuario').value,
                    telefone: document.getElementById('vendedorTelefone').value,
                    metaMes: parseFloat(document.getElementById('vendedorMeta').value),
                    comissao: parseFloat(document.getElementById('vendedorComissao').value)
                };
                
                if (id) {
                    // Editar vendedor existente
                    const index = vendedoresData.findIndex(v => v.id == id);
                    if (index !== -1) {
                        vendedoresData[index] = { ...vendedoresData[index], ...vendedorData };
                        createNotification('success', 'Vendedor Atualizado', `Dados de ${vendedorData.nome} foram atualizados`);
                    }
                } else {
                    // Criar novo vendedor
                    const novoVendedor = {
                        id: Date.now(),
                        ...vendedorData
                    };
                    vendedoresData.push(novoVendedor);
                    createNotification('success', 'Vendedor Cadastrado', `${vendedorData.nome} foi adicionado √† equipe`);
                }
                
                saveData();
                updateVendedoresList();
                updateVendedoresTable();
                populateVendedorSelects();
                resetVendedorForm();
            });
        }

        function resetVendedorForm() {
            const form = document.getElementById('vendedorForm');
            if (form) {
                form.reset();
                document.getElementById('vendedorId').value = '';
            }
        }

        function editarVendedorData(id) {
            const vendedor = vendedoresData.find(v => v.id == id);
            if (!vendedor) return;
            
            document.getElementById('vendedorId').value = vendedor.id;
            document.getElementById('vendedorNome').value = vendedor.nome;
            document.getElementById('vendedorUsuario').value = vendedor.usuario;
            document.getElementById('vendedorTelefone').value = vendedor.telefone;
            document.getElementById('vendedorMeta').value = vendedor.metaMes;
            document.getElementById('vendedorComissao').value = vendedor.comissao;
            
            // Scroll para o formul√°rio
            document.getElementById('vendedorForm').scrollIntoView({ behavior: 'smooth' });
        }

        async function excluirVendedorData(id) {
            const vendedor = vendedoresData.find(v => v.id == id);
            if (!vendedor) return;
            
            const confirmResult = await customConfirm(
                'Excluir Vendedor',
                `Tem certeza que deseja excluir ${vendedor.nome} da equipe?`
            );
            
            if (confirmResult) {
                vendedoresData = vendedoresData.filter(v => v.id !== id);
                saveData();
                
                createRealtimeNotification('warning', 'Vendedor Exclu√≠do', `${vendedor.nome} foi removido da equipe`);
                
                updateVendedoresList();
                updateVendedoresTable();
                populateVendedorSelects();
            }
        }

        function populateVendedorSelects() {
            const vendedores = usuarios.filter(u => u.tipo === 'vendedor');
            const selects = ['indicacaoVendedor', 'vendaVendedor'];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">Selecione um vendedor</option>';
                    vendedores.forEach(vendedor => {
                        const option = document.createElement('option');
                        option.value = vendedor.nome;
                        option.textContent = vendedor.nome;
                        select.appendChild(option);
                    });
                }
            });
        }

        // ===== FUN√á√ïES DE C√ÅLCULO DE COMISS√ÉO =====
        function updateVendedorComissao() {
            const vendedorSelecionado = document.getElementById('vendaVendedor').value;
            const infoElement = document.getElementById('vendaComissaoVendedorInfo');
            
            if (vendedorSelecionado) {
                const vendedorData = vendedoresData.find(v => v.nome === vendedorSelecionado);
                const percentual = vendedorData ? vendedorData.comissao : 10;
                infoElement.textContent = `Baseado no % do vendedor (${percentual}%)`;
            } else {
                infoElement.textContent = 'Baseado no % do vendedor';
            }
            
            calculateComissoes();
        }
        
        function calculateComissoes() {
            const premioLiquido = parseFloat(document.getElementById('vendaPremio').value) || 0;
            const percentualComissao = parseFloat(document.getElementById('vendaPercentualComissao').value) || 0;
            const vendedorSelecionado = document.getElementById('vendaVendedor').value;
            
            // Calcular comiss√£o total (% da empresa sobre o pr√™mio)
            const comissaoTotal = (premioLiquido * percentualComissao) / 100;
            document.getElementById('vendaComissaoTotal').value = comissaoTotal.toFixed(2);
            
            // Calcular comiss√£o do vendedor (% do vendedor sobre o pr√™mio, N√ÉO sobre a comiss√£o total)
            if (vendedorSelecionado) {
                const vendedorData = vendedoresData.find(v => v.nome === vendedorSelecionado);
                const percentualVendedor = vendedorData ? vendedorData.comissao : 10;
                const comissaoVendedor = (premioLiquido * percentualVendedor) / 100;
                document.getElementById('vendaComissaoVendedor').value = comissaoVendedor.toFixed(2);
            } else {
                document.getElementById('vendaComissaoVendedor').value = '0.00';
            }
        }

        function initializeModalForms() {
            document.getElementById('indicacaoForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const editId = this.dataset.editId;
                const indicacaoData = {
                    nome: document.getElementById('indicacaoNome').value,
                    telefone: document.getElementById('indicacaoTelefone').value,
                    veiculo: document.getElementById('indicacaoVeiculo').value,
                    vendedor: document.getElementById('indicacaoVendedor').value,
                    observacoes: document.getElementById('indicacaoObservacoes').value
                };
                
                try {
                    if (editId) {
                        // Editar indica√ß√£o existente
                        const indicacao = indicacoes.find(i => i.id == editId);
                        if (indicacao) {
                            Object.assign(indicacao, indicacaoData);
                            indicacao.lastUpdated = Date.now();
                            indicacao.updatedBy = currentUser.nome;
                            
                            // Atualizar no Firebase
                            await database.ref(`indicacoes/${editId}`).update({
                                ...indicacaoData,
                                lastUpdated: indicacao.lastUpdated,
                                updatedBy: indicacao.updatedBy
                            });
                            
                            createRealtimeNotification('success', 
                                'Indica√ß√£o Atualizada', 
                                `Dados de ${indicacaoData.nome} foram atualizados`
                            );
                        }
                    } else {
                        // Criar nova indica√ß√£o
                        const novaIndicacao = {
                            id: Date.now(),
                            ...indicacaoData,
                            status: 'Lead Novo',
                            data: new Date().toLocaleDateString('pt-BR'),
                            observacoes: '',
                            assignedBy: currentUser.nome,
                            timestamp: Date.now()
                        };
                        
                        // Salvar no Firebase
                        await database.ref(`indicacoes/${novaIndicacao.id}`).set(novaIndicacao);
                        
                        // Encontrar ID do vendedor
                        const vendedorUser = usuarios.find(u => u.nome === novaIndicacao.vendedor);
                        
                        // Enviar notifica√ß√£o para o vendedor
                        if (vendedorUser) {
                            await sendRealtimeNotification(vendedorUser.id, {
                                tipo: 'success',
                                titulo: 'üéØ Nova Indica√ß√£o Recebida!',
                                mensagem: `${novaIndicacao.nome} foi atribu√≠do a voc√™ por ${currentUser.nome}`,
                                dados: novaIndicacao
                            });
                        }
                        
                        createRealtimeNotification('success', 
                            'Indica√ß√£o Criada', 
                            `Indica√ß√£o de ${novaIndicacao.nome} foi enviada para ${novaIndicacao.vendedor}`
                        );
                    }
                    
                    closeModal('novaIndicacaoModal');
                    this.reset();
                    delete this.dataset.editId;
                    
                    // Resetar bot√£o
                    const submitBtn = this.querySelector('button[type="submit"]');
                    submitBtn.innerHTML = '<i class="fas fa-plus mr-2"></i>Adicionar';
                    
                } catch (error) {
                    console.error('Erro ao salvar indica√ß√£o:', error);
                    createRealtimeNotification('error', 'Erro', 'N√£o foi poss√≠vel salvar a indica√ß√£o. Tente novamente.');
                }
            });

            document.getElementById('vendaForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const editId = this.dataset.editId;
                const vendaData = {
                    cliente: document.getElementById('vendaCliente').value,
                    empresa: document.getElementById('vendaEmpresa').value,
                    produto: document.getElementById('vendaProduto').value,
                    vendedor: document.getElementById('vendaVendedor').value,
                    premioLiquido: parseFloat(document.getElementById('vendaPremio').value),
                    percentualComissao: parseFloat(document.getElementById('vendaPercentualComissao').value),
                    comissaoTotal: parseFloat(document.getElementById('vendaComissaoTotal').value),
                    comissaoVendedor: parseFloat(document.getElementById('vendaComissaoVendedor').value)
                };
                
                try {
                    if (editId) {
                        // Editar venda existente
                        const venda = vendas.find(v => v.id == editId);
                        if (venda) {
                            Object.assign(venda, vendaData);
                            venda.lastUpdated = Date.now();
                            venda.updatedBy = currentUser.nome;
                            
                            // Atualizar no Firebase
                            await database.ref(`vendas/${editId}`).update({
                                ...vendaData,
                                lastUpdated: venda.lastUpdated,
                                updatedBy: venda.updatedBy
                            });
                            
                            createRealtimeNotification('success', 
                                'Venda Atualizada', 
                                `Dados de ${vendaData.cliente} foram atualizados`
                            );
                        }
                    } else {
                        // Criar nova venda
                        const novaVenda = {
                            id: Date.now(),
                            ...vendaData,
                            status: 'Fazer Vistoria',
                            data: new Date().toLocaleDateString('pt-BR'),
                            timestamp: Date.now(),
                            createdBy: currentUser.nome
                        };
                        
                        // Salvar no Firebase
                        await database.ref(`vendas/${novaVenda.id}`).set(novaVenda);
                        
                        // Encontrar ID do vendedor
                        const vendedorUser = usuarios.find(u => u.nome === novaVenda.vendedor);
                        
                        // Enviar notifica√ß√£o para o vendedor
                        if (vendedorUser) {
                            await sendRealtimeNotification(vendedorUser.id, {
                                tipo: 'success',
                                titulo: 'üí∞ Nova Venda Registrada!',
                                mensagem: `Venda de ${novaVenda.cliente} (R$ ${novaVenda.premioLiquido.toLocaleString('pt-BR', {minimumFractionDigits: 2})}) foi registrada`,
                                dados: novaVenda
                            });
                        }
                        
                        // Notifica√ß√£o geral para admins
                        await sendRealtimeNotification(null, {
                            tipo: 'success',
                            titulo: 'üéâ Nova Venda!',
                            mensagem: `${novaVenda.cliente} - ${novaVenda.vendedor} - R$ ${novaVenda.premioLiquido.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`,
                            broadcast: true,
                            adminOnly: true
                        });
                        
                        createRealtimeNotification('success', 
                            'Venda Criada', 
                            `Nova venda de ${novaVenda.cliente} por ${novaVenda.vendedor}`
                        );
                    }
                    
                    closeModal('novaVendaModal');
                    this.reset();
                    delete this.dataset.editId;
                    
                    // Resetar bot√£o
                    const submitBtn = this.querySelector('button[type="submit"]');
                    submitBtn.innerHTML = '<i class="fas fa-plus mr-2"></i>Adicionar';
                    
                } catch (error) {
                    console.error('Erro ao salvar venda:', error);
                    createRealtimeNotification('error', 'Erro', 'N√£o foi poss√≠vel salvar a venda. Tente novamente.');
                }
            });
        }

        function showNovaIndicacaoModal() {
            document.getElementById('novaIndicacaoModal').classList.remove('hidden');
        }

        function showNovaVendaModal() {
            document.getElementById('novaVendaModal').classList.remove('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        async function editarIndicacao(id) {
            try {
                const indicacao = indicacoes.find(i => i.id == id);
                if (!indicacao) return;
                
                // Preencher modal com dados da indica√ß√£o
                document.getElementById('indicacaoNome').value = indicacao.nome;
                document.getElementById('indicacaoTelefone').value = indicacao.telefone;
                document.getElementById('indicacaoVeiculo').value = indicacao.veiculo;
                document.getElementById('indicacaoVendedor').value = indicacao.vendedor;
                document.getElementById('indicacaoObservacoes').value = indicacao.observacoes || '';
                
                // Adicionar ID para edi√ß√£o
                const form = document.getElementById('indicacaoForm');
                form.dataset.editId = id;
                
                // Alterar texto do bot√£o
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.innerHTML = '<i class="fas fa-save mr-2"></i>Salvar Altera√ß√µes';
                
                // Mostrar modal
                showNovaIndicacaoModal();
                
            } catch (error) {
                console.error('Erro ao editar indica√ß√£o:', error);
                createRealtimeNotification('error', 'Erro', 'N√£o foi poss√≠vel carregar os dados da indica√ß√£o');
            }
        }

        async function excluirIndicacao(id) {
            const indicacao = indicacoes.find(i => i.id == id);
            if (indicacao) {
                const confirmResult = await customConfirm(
                    'Excluir Indica√ß√£o',
                    `Tem certeza que deseja excluir a indica√ß√£o de ${indicacao.nome}?`
                );
                
                if (confirmResult) {
                    indicacoes = indicacoes.filter(i => i.id !== id);
                    saveData();
                    
                    createRealtimeNotification('warning', 
                        'Indica√ß√£o Exclu√≠da', 
                        `Indica√ß√£o de ${indicacao.nome} foi removida do sistema`
                    );
                    
                    updateIndicacoesTable();
                    updateKanbanIndicacoes();
                    updateDashboard();
                }
            }
        }

        async function editarVenda(id) {
            try {
                const venda = vendas.find(v => v.id == id);
                if (!venda) return;
                
                // Preencher modal com dados da venda
                document.getElementById('vendaCliente').value = venda.cliente;
                document.getElementById('vendaEmpresa').value = venda.empresa;
                document.getElementById('vendaProduto').value = venda.produto;
                document.getElementById('vendaVendedor').value = venda.vendedor;
                document.getElementById('vendaPremio').value = venda.premioLiquido;
                document.getElementById('vendaPercentualComissao').value = venda.percentualComissao || 15;
                document.getElementById('vendaComissaoTotal').value = venda.comissaoTotal || 0;
                document.getElementById('vendaComissaoVendedor').value = venda.comissaoVendedor || 0;
                
                // Atualizar informa√ß√µes do vendedor
                updateVendedorComissao();
                
                // Adicionar ID para edi√ß√£o
                const form = document.getElementById('vendaForm');
                form.dataset.editId = id;
                
                // Alterar texto do bot√£o
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.innerHTML = '<i class="fas fa-save mr-2"></i>Salvar Altera√ß√µes';
                
                // Mostrar modal
                showNovaVendaModal();
                
            } catch (error) {
                console.error('Erro ao editar venda:', error);
                createRealtimeNotification('error', 'Erro', 'N√£o foi poss√≠vel carregar os dados da venda');
            }
        }

        async function excluirVenda(id) {
            const venda = vendas.find(v => v.id == id);
            if (venda) {
                const confirmResult = await customConfirm(
                    'Excluir Venda',
                    `Tem certeza que deseja excluir a venda de ${venda.cliente}?`
                );
                
                if (confirmResult) {
                    vendas = vendas.filter(v => v.id !== id);
                    saveData();
                    
                    createRealtimeNotification('warning', 
                        'Venda Exclu√≠da', 
                        `Venda de ${venda.cliente} foi removida do sistema`
                    );
                    
                    updateVendasTable();
                    updateKanbanVendas();
                    updateDashboard();
                    updateVendedoresList();
                }
            }
        }

        // ===== SISTEMA DE NOTIFICA√á√ïES EM TEMPO REAL =====
        async function sendRealtimeNotification(userId, notificationData) {
            try {
                const notification = {
                    ...notificationData,
                    timestamp: Date.now(),
                    from: currentUser.nome,
                    fromId: currentUser.id,
                    lida: false,
                    id: Date.now() + Math.random()
                };

                if (notificationData.broadcast) {
                    // Enviar para todos os usu√°rios online
                    const promises = [];
                    
                    for (const [uid, userData] of Object.entries(usuariosOnline)) {
                        if (userData.online && uid != currentUser.id) {
                            // Se adminOnly for true, enviar apenas para admins
                            if (notificationData.adminOnly) {
                                const user = usuarios.find(u => u.id == uid);
                                if (user && user.tipo === 'admin') {
                                    promises.push(
                                        database.ref(`notificacoes/${uid}/${notification.id}`).set(notification)
                                    );
                                }
                            } else {
                                promises.push(
                                    database.ref(`notificacoes/${uid}/${notification.id}`).set(notification)
                                );
                            }
                        }
                    }
                    
                    await Promise.all(promises);
                } else if (userId) {
                    // Enviar para usu√°rio espec√≠fico
                    await database.ref(`notificacoes/${userId}/${notification.id}`).set(notification);
                }

                console.log('üì® Notifica√ß√£o enviada:', notification);
            } catch (error) {
                console.error('Erro ao enviar notifica√ß√£o:', error);
            }
        }

        function createRealtimeNotification(type, title, message, autoClose = true) {
            const notification = document.createElement('div');
            notification.className = `notification bg-gray-800 border-l-4 p-4 rounded-lg shadow-lg animate-pulse ${
                type === 'success' ? 'border-green-500' : 
                type === 'warning' ? 'border-yellow-500' : 
                type === 'error' ? 'border-red-500' :
                'border-blue-500'
            }`;
            
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas ${
                            type === 'success' ? 'fa-check-circle text-green-500' : 
                            type === 'warning' ? 'fa-exclamation-triangle text-yellow-500' : 
                            type === 'error' ? 'fa-times-circle text-red-500' :
                            'fa-info-circle text-blue-500'
                        } mr-3 text-lg"></i>
                        <div>
                            <h4 class="text-white font-medium">${title}</h4>
                            <p class="text-gray-300 text-sm">${message}</p>
                            <p class="text-gray-500 text-xs mt-1">${new Date().toLocaleTimeString('pt-BR')}</p>
                        </div>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-gray-400 hover:text-white ml-4">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Remover anima√ß√£o ap√≥s 1 segundo
            setTimeout(() => {
                notification.classList.remove('animate-pulse');
            }, 1000);
            
            if (autoClose) {
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.style.opacity = '0';
                        notification.style.transform = 'translateX(100%)';
                        setTimeout(() => notification.remove(), 300);
                    }
                }, 5000);
            }
        }

        // ===== FUN√á√ïES DE NAVEGA√á√ÉO DO KANBAN =====
        function getKanbanNavigationButtons(currentStatus, vendaId) {
            const statusOrder = ['Fazer Vistoria', 'Mandar Boletos', 'Falta Pagamento', 'Pagamento Efetuado'];
            const currentIndex = statusOrder.indexOf(currentStatus);
            
            let buttons = '';
            
            // Bot√£o Voltar (se n√£o for o primeiro)
            if (currentIndex > 0) {
                const prevStatus = statusOrder[currentIndex - 1];
                buttons += `
                    <button onclick="moveVendaToStatus(${vendaId}, '${prevStatus}')" 
                            class="bg-gray-600 hover:bg-gray-500 text-white text-xs px-2 py-1 rounded flex items-center transition-all duration-200"
                            title="Voltar para ${prevStatus}">
                        <i class="fas fa-chevron-left text-xs"></i>
                    </button>
                `;
            }
            
            // Bot√£o Avan√ßar (se n√£o for o √∫ltimo)
            if (currentIndex < statusOrder.length - 1) {
                const nextStatus = statusOrder[currentIndex + 1];
                buttons += `
                    <button onclick="moveVendaToStatus(${vendaId}, '${nextStatus}')" 
                            class="bg-blue-600 hover:bg-blue-500 text-white text-xs px-2 py-1 rounded flex items-center transition-all duration-200"
                            title="Avan√ßar para ${nextStatus}">
                        <i class="fas fa-chevron-right text-xs"></i>
                    </button>
                `;
            }
            
            return buttons;
        }
        
        async function moveVendaToStatus(vendaId, newStatus) {
            try {
                const venda = vendas.find(v => v.id == vendaId);
                if (!venda) return;
                
                const oldStatus = venda.status;
                venda.status = newStatus;
                venda.lastUpdated = Date.now();
                venda.updatedBy = currentUser.nome;
                
                // Se mudou para "Pagamento Efetuado", criar comiss√£o automaticamente
                if (newStatus === 'Pagamento Efetuado' && oldStatus !== 'Pagamento Efetuado') {
                    await criarComissaoAutomatica(venda);
                }
                
                // Atualizar no Firebase
                await database.ref(`vendas/${venda.id}`).update({
                    status: newStatus,
                    lastUpdated: venda.lastUpdated,
                    updatedBy: venda.updatedBy
                });
                
                // Notificar vendedor sobre mudan√ßa de status
                const vendedorUser = usuarios.find(u => u.nome === venda.vendedor);
                if (vendedorUser && vendedorUser.id !== currentUser.id) {
                    await sendRealtimeNotification(vendedorUser.id, {
                        tipo: 'info',
                        titulo: 'üìã Status Atualizado',
                        mensagem: `${venda.cliente} foi movido de "${oldStatus}" para "${newStatus}" por ${currentUser.nome}`,
                        dados: venda
                    });
                }
                
                createRealtimeNotification('success', 
                    'Status Atualizado', 
                    `${venda.cliente} movido para ${newStatus}`
                );
                
                updateKanbanVendas();
                
            } catch (error) {
                console.error('Erro ao mover venda:', error);
                createRealtimeNotification('error', 'Erro', 'N√£o foi poss√≠vel atualizar o status');
            }
        }

        // ===== SISTEMA DE MODAIS PERSONALIZADOS =====
        function customConfirm(title, message) {
            return new Promise((resolve) => {
                const modal = document.getElementById('customConfirmModal');
                const titleElement = document.getElementById('confirmTitle');
                const messageElement = document.getElementById('confirmMessage');
                const cancelBtn = document.getElementById('confirmCancel');
                const okBtn = document.getElementById('confirmOk');
                
                titleElement.textContent = title;
                messageElement.textContent = message;
                
                modal.classList.remove('hidden');
                
                const handleCancel = () => {
                    modal.classList.add('hidden');
                    cancelBtn.removeEventListener('click', handleCancel);
                    okBtn.removeEventListener('click', handleOk);
                    resolve(false);
                };
                
                const handleOk = () => {
                    modal.classList.add('hidden');
                    cancelBtn.removeEventListener('click', handleCancel);
                    okBtn.removeEventListener('click', handleOk);
                    resolve(true);
                };
                
                cancelBtn.addEventListener('click', handleCancel);
                okBtn.addEventListener('click', handleOk);
            });
        }
        
        function customPrompt(title, message, placeholder = '') {
            return new Promise((resolve) => {
                const modal = document.getElementById('customPromptModal');
                const titleElement = document.getElementById('promptTitle');
                const messageElement = document.getElementById('promptMessage');
                const inputElement = document.getElementById('promptInput');
                const cancelBtn = document.getElementById('promptCancel');
                const okBtn = document.getElementById('promptOk');
                
                titleElement.textContent = title;
                messageElement.textContent = message;
                inputElement.value = '';
                inputElement.placeholder = placeholder;
                
                modal.classList.remove('hidden');
                inputElement.focus();
                
                const handleCancel = () => {
                    modal.classList.add('hidden');
                    cancelBtn.removeEventListener('click', handleCancel);
                    okBtn.removeEventListener('click', handleOk);
                    inputElement.removeEventListener('keypress', handleKeypress);
                    resolve(null);
                };
                
                const handleOk = () => {
                    const value = inputElement.value.trim();
                    if (value) {
                        modal.classList.add('hidden');
                        cancelBtn.removeEventListener('click', handleCancel);
                        okBtn.removeEventListener('click', handleOk);
                        inputElement.removeEventListener('keypress', handleKeypress);
                        resolve(value);
                    } else {
                        inputElement.focus();
                        inputElement.style.borderColor = '#ef4444';
                        setTimeout(() => {
                            inputElement.style.borderColor = '#4b5563';
                        }, 1000);
                    }
                };
                
                const handleKeypress = (e) => {
                    if (e.key === 'Enter' && e.ctrlKey) {
                        handleOk();
                    } else if (e.key === 'Escape') {
                        handleCancel();
                    }
                };
                
                cancelBtn.addEventListener('click', handleCancel);
                okBtn.addEventListener('click', handleOk);
                inputElement.addEventListener('keypress', handleKeypress);
            });
        }

        // Fun√ß√µes auxiliares
        function saveData() {
            try {
                const dataToSave = {
                    indicacoes,
                    vendas,
                    vendedoresData,
                    leadsSuhai,
                    leadsSemSucesso,
                    comissoes,
                    cancelamentos,
                    linksUteis,
                    timestamp: Date.now()
                };
                
                localStorage.setItem('vmSegurosData', JSON.stringify(dataToSave));
                console.log('üíæ Dados salvos localmente:', dataToSave);
            } catch (error) {
                console.error('‚ùå Erro ao salvar dados localmente:', error);
            }
        }

        function initializeDragAndDrop() {
            // Implementar drag and drop para os kanbans
            const containers = document.querySelectorAll('[id$="Container"]');
            
            containers.forEach(container => {
                container.addEventListener('dragover', handleDragOver);
                container.addEventListener('drop', handleDrop);
            });
        }

        function handleDragStart(e, type, id) {
            e.dataTransfer.setData('text/plain', JSON.stringify({ type, id }));
            e.target.style.opacity = '0.5';
        }

        function handleDragEnd(e) {
            e.target.style.opacity = '1';
        }

        function handleDragOver(e) {
            e.preventDefault();
        }

        async function handleDrop(e) {
            e.preventDefault();
            
            const data = JSON.parse(e.dataTransfer.getData('text/plain'));
            const containerId = e.currentTarget.id;
            
            let newStatus = '';
            
            // Mapear container para status
            if (containerId.includes('fazerVistoria')) newStatus = 'Fazer Vistoria';
            else if (containerId.includes('mandarBoletos')) newStatus = 'Mandar Boletos';
            else if (containerId.includes('faltaPagamento')) newStatus = 'Falta Pagamento';
            else if (containerId.includes('pagamentoEfetuado')) newStatus = 'Pagamento Efetuado';
            else if (containerId.includes('leadNovo')) newStatus = 'Lead Novo';
            else if (containerId.includes('whatsapp')) newStatus = 'WhatsApp';
            else if (containerId.includes('negociando')) newStatus = 'Negociando';
            else if (containerId.includes('pedindoDados')) newStatus = 'Pedindo Dados';
            
            try {
                if (data.type === 'venda') {
                    const venda = vendas.find(v => v.id == data.id);
                    if (venda && venda.status !== newStatus) {
                        const oldStatus = venda.status;
                        venda.status = newStatus;
                        venda.lastUpdated = Date.now();
                        venda.updatedBy = currentUser.nome;
                        
                        // Se mudou para "Pagamento Efetuado", criar comiss√£o automaticamente
                        if (newStatus === 'Pagamento Efetuado' && oldStatus !== 'Pagamento Efetuado') {
                            await criarComissaoAutomatica(venda);
                        }
                        
                        // Atualizar no Firebase
                        await database.ref(`vendas/${venda.id}`).update({
                            status: newStatus,
                            lastUpdated: venda.lastUpdated,
                            updatedBy: venda.updatedBy
                        });
                        
                        // Notificar vendedor sobre mudan√ßa de status
                        const vendedorUser = usuarios.find(u => u.nome === venda.vendedor);
                        if (vendedorUser && vendedorUser.id !== currentUser.id) {
                            await sendRealtimeNotification(vendedorUser.id, {
                                tipo: 'info',
                                titulo: 'üìã Status Atualizado',
                                mensagem: `${venda.cliente} foi movido de "${oldStatus}" para "${newStatus}" por ${currentUser.nome}`,
                                dados: venda
                            });
                        }
                        
                        createRealtimeNotification('success', 
                            'Status Atualizado', 
                            `${venda.cliente} movido para ${newStatus}`
                        );
                    }
                } else if (data.type === 'indicacao') {
                    const indicacao = indicacoes.find(i => i.id == data.id);
                    if (indicacao && indicacao.status !== newStatus) {
                        const oldStatus = indicacao.status;
                        indicacao.status = newStatus;
                        indicacao.lastUpdated = Date.now();
                        indicacao.updatedBy = currentUser.nome;
                        
                        // Atualizar no Firebase
                        await database.ref(`indicacoes/${indicacao.id}`).update({
                            status: newStatus,
                            lastUpdated: indicacao.lastUpdated,
                            updatedBy: indicacao.updatedBy
                        });
                        
                        // Notificar vendedor sobre mudan√ßa de status
                        const vendedorUser = usuarios.find(u => u.nome === indicacao.vendedor);
                        if (vendedorUser && vendedorUser.id !== currentUser.id) {
                            await sendRealtimeNotification(vendedorUser.id, {
                                tipo: 'info',
                                titulo: 'üéØ Status da Indica√ß√£o Atualizado',
                                mensagem: `${indicacao.nome} foi movido de "${oldStatus}" para "${newStatus}" por ${currentUser.nome}`,
                                dados: indicacao
                            });
                        }
                        
                        createRealtimeNotification('success', 
                            'Status Atualizado', 
                            `${indicacao.nome} movido para ${newStatus}`
                        );
                    }
                }
            } catch (error) {
                console.error('Erro ao atualizar status:', error);
                createRealtimeNotification('error', 'Erro', 'N√£o foi poss√≠vel atualizar o status. Tente novamente.');
            }
        }

        function updateDebugCredentials() {
            const debugContainer = document.getElementById('debugVendedoresList');
            if (!debugContainer) return;
            
            debugContainer.innerHTML = '';
            
            const vendedores = usuarios.filter(u => u.tipo === 'vendedor');
            
            vendedores.forEach((vendedor, index) => {
                const vendedorDiv = document.createElement('div');
                vendedorDiv.className = 'bg-blue-900 bg-opacity-30 p-3 rounded border border-blue-600';
                
                vendedorDiv.innerHTML = `
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <div>
                            <span class="text-blue-300 font-medium">Nome:</span>
                            <p class="text-white">${vendedor.nome}</p>
                        </div>
                        <div>
                            <span class="text-blue-300 font-medium">Login:</span>
                            <p class="text-white font-mono">${vendedor.login}</p>
                        </div>
                        <div>
                            <span class="text-blue-300 font-medium">Senha:</span>
                            <p class="text-white font-mono">${vendedor.senha}</p>
                        </div>
                    </div>
                `;
                
                debugContainer.appendChild(vendedorDiv);
            });
            
            // Adicionar contador
            const totalDiv = document.createElement('div');
            totalDiv.className = 'bg-gray-700 p-3 rounded border border-gray-500 mt-3';
            totalDiv.innerHTML = `
                <div class="flex items-center justify-between">
                    <span class="text-gray-300 font-medium">Total de Vendedores:</span>
                    <span class="text-white font-bold text-lg">${vendedores.length}</span>
                </div>
            `;
            debugContainer.appendChild(totalDiv);
        }

        // ===== NOVAS FUN√á√ïES PARA LEAD SUHAI E SEM SUCESSO =====
        
        async function toggleLeadSuhai(vendaId) {
            try {
                const id = parseInt(vendaId);
                const venda = vendas.find(v => v.id === id);
                if (!venda) return;
                
                venda.leadSuhai = !venda.leadSuhai;
                venda.lastUpdated = Date.now();
                venda.updatedBy = currentUser.nome;
                
                // Atualizar no Firebase
                await database.ref(`vendas/${venda.id}`).update({
                    leadSuhai: venda.leadSuhai,
                    lastUpdated: venda.lastUpdated,
                    updatedBy: venda.updatedBy
                });
                
                if (venda.leadSuhai) {
                    // Adicionar √† lista de leads Suhai
                    const leadSuhai = {
                        id: venda.id,
                        nomeCompleto: venda.cliente,
                        vendedor: venda.vendedor,
                        comissaoVenda: venda.premioLiquido * 0.1, // 10% de comiss√£o exemplo
                        data: venda.data,
                        vendaOriginal: venda
                    };
                    
                    await database.ref(`leadsSuhai/${venda.id}`).set(leadSuhai);
                    
                    createRealtimeNotification('success', 
                        'Lead Suhai Adicionado', 
                        `${venda.cliente} foi marcado como Lead Suhai`
                    );
                } else {
                    // Remover da lista de leads Suhai
                    await database.ref(`leadsSuhai/${venda.id}`).remove();
                    
                    createRealtimeNotification('info', 
                        'Lead Suhai Removido', 
                        `${venda.cliente} foi desmarcado como Lead Suhai`
                    );
                }
                
                updateKanbanVendas();
                updateLeadSuhaiTable();
                
            } catch (error) {
                console.error('Erro ao atualizar Lead Suhai:', error);
                createRealtimeNotification('error', 'Erro', 'N√£o foi poss√≠vel atualizar o Lead Suhai');
            }
        }
        
        async function toggleNaoAtendeu(indicacaoId) {
            try {
                const id = parseInt(indicacaoId);
                const indicacao = indicacoes.find(i => i.id === id);
                if (!indicacao) return;
                
                indicacao.naoAtendeu = !indicacao.naoAtendeu;
                indicacao.lastUpdated = Date.now();
                indicacao.updatedBy = currentUser.nome;
                
                // Atualizar no Firebase
                await database.ref(`indicacoes/${indicacao.id}`).update({
                    naoAtendeu: indicacao.naoAtendeu,
                    lastUpdated: indicacao.lastUpdated,
                    updatedBy: indicacao.updatedBy
                });
                
                updateKanbanIndicacoes();
                
                const status = indicacao.naoAtendeu ? 'marcado' : 'desmarcado';
                createRealtimeNotification('info', 
                    'Status Atualizado', 
                    `${indicacao.nome} foi ${status} como "N√£o Atendeu"`
                );
                
            } catch (error) {
                console.error('Erro ao atualizar N√£o Atendeu:', error);
                createRealtimeNotification('error', 'Erro', 'N√£o foi poss√≠vel atualizar o status');
            }
        }
        
        async function converterIndicacao(indicacaoId) {
            try {
                console.log('üîÑ Convertendo indica√ß√£o ID:', indicacaoId);
                
                // Garantir que indicacaoId √© um n√∫mero
                const id = parseInt(indicacaoId);
                
                const indicacao = indicacoes.find(i => i.id === id);
                if (!indicacao) {
                    console.error('‚ùå Indica√ß√£o n√£o encontrada:', indicacaoId, 'Array atual:', indicacoes);
                    createRealtimeNotification('error', 'Erro', 'Indica√ß√£o n√£o encontrada');
                    return;
                }
                
                const confirmResult = await customConfirm(
                    'Converter Indica√ß√£o',
                    `Tem certeza que deseja converter ${indicacao.nome} em venda?`
                );
                
                if (!confirmResult) return;
                
                console.log('‚úÖ Indica√ß√£o encontrada:', indicacao);
                
                // Criar nova venda baseada na indica√ß√£o
                const novaVenda = {
                    id: Date.now(),
                    cliente: indicacao.nome,
                    produto: 'Seguro Auto', // Produto padr√£o
                    empresa: 'A definir',
                    vendedor: indicacao.vendedor,
                    premioLiquido: 0, // Ser√° preenchido depois
                    status: 'Fazer Vistoria',
                    data: new Date().toLocaleDateString('pt-BR'),
                    timestamp: Date.now(),
                    createdBy: currentUser ? currentUser.nome : 'Sistema',
                    convertidaDe: indicacao.id,
                    telefone: indicacao.telefone,
                    veiculo: indicacao.veiculo
                };
                
                console.log('üíæ Salvando nova venda:', novaVenda);
                
                // Salvar nova venda no Firebase
                if (isOnline) {
                    await database.ref(`vendas/${novaVenda.id}`).set(novaVenda);
                    console.log('‚úÖ Venda salva no Firebase');
                }
                
                // Remover indica√ß√£o do Firebase
                if (isOnline) {
                    await database.ref(`indicacoes/${indicacao.id}`).remove();
                    console.log('‚úÖ Indica√ß√£o removida do Firebase');
                }
                
                // Atualizar arrays locais
                vendas.push(novaVenda);
                indicacoes = indicacoes.filter(i => i.id !== id);
                
                console.log('üîÑ Atualizando interfaces...');
                
                // Atualizar interfaces
                updateKanbanIndicacoes();
                updateKanbanVendas();
                updateIndicacoesTable();
                updateVendasTable();
                updateDashboard();
                
                // Salvar localmente
                saveData();
                
                // Notificar vendedor
                const vendedorUser = usuarios.find(u => u.nome === indicacao.vendedor);
                if (vendedorUser && isOnline) {
                    await sendRealtimeNotification(vendedorUser.id, {
                        tipo: 'success',
                        titulo: 'üéØ Indica√ß√£o Convertida!',
                        mensagem: `${indicacao.nome} foi convertido em venda por ${currentUser ? currentUser.nome : 'Sistema'}`,
                        dados: novaVenda
                    });
                }
                
                createRealtimeNotification('success', 
                    'Indica√ß√£o Convertida', 
                    `${indicacao.nome} foi convertido em venda e movido para Kanban Vendas - Fazer Vistoria!`
                );
                
                console.log('‚úÖ Convers√£o conclu√≠da com sucesso!');
                
            } catch (error) {
                console.error('‚ùå Erro ao converter indica√ß√£o:', error);
                createRealtimeNotification('error', 'Erro', 'N√£o foi poss√≠vel converter a indica√ß√£o: ' + error.message);
            }
        }
        
        async function marcarSemSucesso(indicacaoId) {
            try {
                console.log('‚ùå Marcando sem sucesso ID:', indicacaoId);
                
                // Garantir que indicacaoId √© um n√∫mero
                const id = parseInt(indicacaoId);
                
                const indicacao = indicacoes.find(i => i.id === id);
                if (!indicacao) {
                    console.error('‚ùå Indica√ß√£o n√£o encontrada:', indicacaoId, 'Array atual:', indicacoes);
                    createRealtimeNotification('error', 'Erro', 'Indica√ß√£o n√£o encontrada');
                    return;
                }
                
                const motivo = await customPrompt(
                    'Motivo do Insucesso',
                    `Por que ${indicacao.nome} n√£o teve sucesso?\n\nMotivos comuns:\n‚Ä¢ N√£o atendeu\n‚Ä¢ N√£o interessado\n‚Ä¢ Pre√ßo alto\n‚Ä¢ J√° tem seguro\n‚Ä¢ Outro`,
                    'Digite o motivo...'
                );
                
                if (!motivo) return;
                
                console.log('‚úÖ Indica√ß√£o encontrada:', indicacao);
                console.log('üìù Motivo:', motivo);
                
                // Criar registro sem sucesso
                const leadSemSucesso = {
                    id: indicacao.id,
                    nome: indicacao.nome,
                    telefone: indicacao.telefone,
                    veiculo: indicacao.veiculo,
                    vendedor: indicacao.vendedor,
                    dataMarcacao: new Date().toLocaleDateString('pt-BR'),
                    dataOriginal: indicacao.data,
                    motivo: motivo.trim(),
                    marcadoPor: currentUser ? currentUser.nome : 'Sistema',
                    timestamp: Date.now(),
                    indicacaoOriginal: indicacao
                };
                
                console.log('üíæ Salvando lead sem sucesso:', leadSemSucesso);
                
                // Salvar no Firebase
                if (isOnline) {
                    await database.ref(`leadsSemSucesso/${indicacao.id}`).set(leadSemSucesso);
                    console.log('‚úÖ Lead sem sucesso salvo no Firebase');
                }
                
                // Remover indica√ß√£o do Firebase
                if (isOnline) {
                    await database.ref(`indicacoes/${indicacao.id}`).remove();
                    console.log('‚úÖ Indica√ß√£o removida do Firebase');
                }
                
                // Atualizar arrays locais
                leadsSemSucesso.push(leadSemSucesso);
                indicacoes = indicacoes.filter(i => i.id !== id);
                
                console.log('üîÑ Atualizando interfaces...');
                
                // Atualizar interfaces
                updateKanbanIndicacoes();
                updateIndicacoesTable();
                updateSemSucessoTable();
                updateDashboard();
                
                // Salvar localmente
                saveData();
                
                // Notificar vendedor
                const vendedorUser = usuarios.find(u => u.nome === indicacao.vendedor);
                if (vendedorUser && isOnline) {
                    await sendRealtimeNotification(vendedorUser.id, {
                        tipo: 'warning',
                        titulo: '‚ùå Lead Marcado Sem Sucesso',
                        mensagem: `${indicacao.nome} foi marcado como sem sucesso: ${motivo}`,
                        dados: leadSemSucesso
                    });
                }
                
                createRealtimeNotification('warning', 
                    'Lead Sem Sucesso', 
                    `${indicacao.nome} foi removido do Kanban Indica√ß√µes e adicionado √† p√°gina Sem Sucesso!`
                );
                
                console.log('‚úÖ Marca√ß√£o sem sucesso conclu√≠da!');
                
            } catch (error) {
                console.error('‚ùå Erro ao marcar sem sucesso:', error);
                createRealtimeNotification('error', 'Erro', 'N√£o foi poss√≠vel marcar como sem sucesso: ' + error.message);
            }
        }
        
        async function reverterSemSucesso(leadId) {
            try {
                const leadSemSucesso = leadsSemSucesso.find(l => l.id == leadId);
                if (!leadSemSucesso) return;
                
                const confirmResult = await customConfirm(
                    'Reverter Lead',
                    `Tem certeza que deseja reverter ${leadSemSucesso.nome} para indica√ß√µes?`
                );
                
                if (!confirmResult) return;
                
                // Restaurar indica√ß√£o original
                const indicacaoRestaurada = {
                    ...leadSemSucesso.indicacaoOriginal,
                    status: 'Lead Novo', // Resetar status
                    restauradaEm: new Date().toLocaleDateString('pt-BR'),
                    restauradaPor: currentUser.nome,
                    lastUpdated: Date.now()
                };
                
                // Salvar indica√ß√£o restaurada no Firebase
                await database.ref(`indicacoes/${indicacaoRestaurada.id}`).set(indicacaoRestaurada);
                
                // Remover de sem sucesso
                await database.ref(`leadsSemSucesso/${leadId}`).remove();
                
                createRealtimeNotification('success', 
                    'Lead Revertido', 
                    `${leadSemSucesso.nome} foi revertido para indica√ß√µes`
                );
                
            } catch (error) {
                console.error('Erro ao reverter lead:', error);
                createRealtimeNotification('error', 'Erro', 'N√£o foi poss√≠vel reverter o lead');
            }
        }
        
        function updateLeadSuhaiTable() {
            const tbody = document.getElementById('leadSuhaiTableBody');
            const countElement = document.getElementById('leadSuhaiCount');
            const totalVendasElement = document.getElementById('totalVendasSuhai');
            const totalComissaoElement = document.getElementById('totalComissaoSuhai');
            const rankingElement = document.getElementById('rankingSuhai');
            
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            const leadsComSuhai = vendas.filter(v => v.leadSuhai);
            
            if (countElement) {
                countElement.textContent = `${leadsComSuhai.length} leads`;
            }
            
            // Calcular totais
            let totalVendas = leadsComSuhai.length;
            let totalComissao = 0;
            
            leadsComSuhai.forEach(venda => {
                const comissao = venda.premioLiquido * 0.1; // 10% de comiss√£o exemplo
                totalComissao += comissao;
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-700';
                row.innerHTML = `
                    <td class="px-6 py-4 text-white font-medium">${venda.cliente}</td>
                    <td class="px-6 py-4 text-gray-300">${venda.vendedor}</td>
                    <td class="px-6 py-4 text-purple-400 font-medium">R$ ${comissao.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                    <td class="px-6 py-4 text-gray-300">${venda.data}</td>
                    <td class="px-6 py-4">
                        <button onclick="toggleLeadSuhai(${venda.id})" class="text-red-400 hover:text-red-300 text-sm">
                            <i class="fas fa-times mr-1"></i>Remover
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // Atualizar totais
            if (totalVendasElement) {
                totalVendasElement.textContent = totalVendas;
            }
            if (totalComissaoElement) {
                totalComissaoElement.textContent = `R$ ${totalComissao.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
            }
            
            // Criar ranking por vendedor
            const vendedorStats = {};
            leadsComSuhai.forEach(venda => {
                if (!vendedorStats[venda.vendedor]) {
                    vendedorStats[venda.vendedor] = {
                        nome: venda.vendedor,
                        vendas: 0,
                        comissao: 0
                    };
                }
                vendedorStats[venda.vendedor].vendas++;
                vendedorStats[venda.vendedor].comissao += venda.premioLiquido * 0.1;
            });
            
            // Ordenar por comiss√£o e pegar top 3
            const ranking = Object.values(vendedorStats)
                .sort((a, b) => b.comissao - a.comissao)
                .slice(0, 3);
            
            // Atualizar ranking
            if (rankingElement) {
                rankingElement.innerHTML = '';
                
                if (ranking.length === 0) {
                    rankingElement.innerHTML = `
                        <div class="text-center text-gray-400 py-4">
                            <i class="fas fa-trophy text-2xl mb-2 block"></i>
                            <p class="text-sm">Nenhum lead Suhai ainda</p>
                        </div>
                    `;
                } else {
                    ranking.forEach((vendedor, index) => {
                        const medalIcons = ['ü•á', 'ü•à', 'ü•â'];
                        const colors = ['text-yellow-400', 'text-gray-300', 'text-orange-400'];
                        
                        const rankItem = document.createElement('div');
                        rankItem.className = 'flex items-center justify-between bg-gray-700 rounded-lg p-3 border border-gray-600';
                        rankItem.innerHTML = `
                            <div class="flex items-center">
                                <span class="text-lg mr-2">${medalIcons[index]}</span>
                                <div>
                                    <p class="text-white font-medium text-sm">${vendedor.nome}</p>
                                    <p class="text-gray-400 text-xs">${vendedor.vendas} vendas</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="${colors[index]} font-bold text-sm">R$ ${vendedor.comissao.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p>
                            </div>
                        `;
                        rankingElement.appendChild(rankItem);
                    });
                }
            }
            
            if (leadsComSuhai.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="5" class="px-6 py-8 text-center text-gray-400">
                        <i class="fas fa-star text-4xl mb-2 block"></i>
                        Nenhum lead Suhai encontrado
                    </td>
                `;
                tbody.appendChild(row);
            }
        }
        
        function updateSemSucessoTable() {
            const tbody = document.getElementById('semSucessoTableBody');
            const countElement = document.getElementById('semSucessoCount');
            
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            if (countElement) {
                countElement.textContent = `${leadsSemSucesso.length} leads`;
            }
            
            leadsSemSucesso.forEach(lead => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-700';
                row.innerHTML = `
                    <td class="px-6 py-4 text-white">${lead.nome}</td>
                    <td class="px-6 py-4 text-gray-300">${lead.telefone}</td>
                    <td class="px-6 py-4 text-gray-300">${lead.veiculo}</td>
                    <td class="px-6 py-4 text-gray-300">${lead.vendedor}</td>
                    <td class="px-6 py-4 text-gray-300">${lead.dataMarcacao}</td>
                    <td class="px-6 py-4 text-red-400">${lead.motivo}</td>
                    <td class="px-6 py-4">
                        <button onclick="reverterSemSucesso(${lead.id})" class="text-green-400 hover:text-green-300 text-sm mr-2">
                            <i class="fas fa-undo mr-1"></i>Reverter
                        </button>
                        <button onclick="excluirSemSucesso(${lead.id})" class="text-red-400 hover:text-red-300 text-sm">
                            <i class="fas fa-trash mr-1"></i>Excluir
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            if (leadsSemSucesso.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="7" class="px-6 py-8 text-center text-gray-400">
                        <i class="fas fa-check-circle text-4xl mb-2 block text-green-500"></i>
                        Nenhum lead sem sucesso! üéâ
                    </td>
                `;
                tbody.appendChild(row);
            }
        }
        
        async function excluirSemSucesso(leadId) {
            try {
                const lead = leadsSemSucesso.find(l => l.id == leadId);
                if (!lead) return;
                
                const confirmResult = await customConfirm(
                    'Excluir Permanentemente',
                    `Tem certeza que deseja excluir permanentemente ${lead.nome}? Esta a√ß√£o n√£o pode ser desfeita.`
                );
                
                if (!confirmResult) return;
                
                // Remover do Firebase
                await database.ref(`leadsSemSucesso/${leadId}`).remove();
                
                createRealtimeNotification('warning', 
                    'Lead Exclu√≠do', 
                    `${lead.nome} foi exclu√≠do permanentemente`
                );
                
            } catch (error) {
                console.error('Erro ao excluir lead sem sucesso:', error);
                createRealtimeNotification('error', 'Erro', 'N√£o foi poss√≠vel excluir o lead');
            }
        }

        // ===== FUN√á√ïES DE COMISS√ÉO =====
        
        async function criarComissaoAutomatica(venda) {
            try {
                // Verificar se j√° existe comiss√£o para esta venda
                const comissaoExistente = comissoes.find(c => c.vendaId === venda.id);
                if (comissaoExistente) {
                    console.log('Comiss√£o j√° existe para esta venda');
                    return;
                }
                
                // Buscar dados do vendedor para calcular comiss√£o
                const vendedorData = vendedoresData.find(v => v.nome === venda.vendedor);
                const percentualComissao = vendedorData ? vendedorData.comissao : 10; // 10% padr√£o
                
                const comissaoTotal = venda.premioLiquido * 0.15; // 15% comiss√£o total da empresa
                const comissaoVendedor = venda.premioLiquido * (percentualComissao / 100);
                
                const novaComissao = {
                    id: Date.now(),
                    vendaId: venda.id,
                    nomeCompleto: venda.cliente,
                    empresa: venda.empresa,
                    vendedor: venda.vendedor,
                    comissaoTotal: comissaoTotal,
                    comissaoVendedor: comissaoVendedor,
                    percentualVendedor: percentualComissao,
                    premioLiquido: venda.premioLiquido,
                    data: new Date().toLocaleDateString('pt-BR'),
                    dataPagamento: new Date().toLocaleDateString('pt-BR'),
                    timestamp: Date.now(),
                    criadaPor: currentUser.nome
                };
                
                // Salvar no Firebase
                await database.ref(`comissoes/${novaComissao.id}`).set(novaComissao);
                
                // Notificar vendedor sobre comiss√£o
                const vendedorUser = usuarios.find(u => u.nome === venda.vendedor);
                if (vendedorUser) {
                    await sendRealtimeNotification(vendedorUser.id, {
                        tipo: 'success',
                        titulo: 'üí∞ Comiss√£o Gerada!',
                        mensagem: `Sua comiss√£o de R$ ${comissaoVendedor.toLocaleString('pt-BR', {minimumFractionDigits: 2})} foi registrada para ${venda.cliente}`,
                        dados: novaComissao
                    });
                }
                
                createRealtimeNotification('success', 
                    'Comiss√£o Criada', 
                    `Comiss√£o de ${venda.vendedor} registrada: R$ ${comissaoVendedor.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`
                );
                
                console.log('‚úÖ Comiss√£o criada automaticamente:', novaComissao);
                
            } catch (error) {
                console.error('Erro ao criar comiss√£o autom√°tica:', error);
                createRealtimeNotification('error', 'Erro', 'N√£o foi poss√≠vel criar a comiss√£o automaticamente');
            }
        }
        
        function updateComissaoTable() {
            const tbody = document.getElementById('comissaoTableBody');
            const countElement = document.getElementById('comissaoCount');
            const totalComissaoElement = document.getElementById('totalComissaoGeral');
            const totalVendasElement = document.getElementById('totalVendasComissao');
            
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Calcular totais
            const totalComissao = comissoes.reduce((sum, c) => sum + c.comissaoTotal, 0);
            const totalVendas = comissoes.length;
            
            // Atualizar elementos de resumo
            if (countElement) {
                countElement.textContent = `${totalVendas} comiss√µes`;
            }
            if (totalComissaoElement) {
                totalComissaoElement.textContent = `R$ ${totalComissao.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
            }
            if (totalVendasElement) {
                totalVendasElement.textContent = totalVendas;
            }
            
            // Preencher tabela
            comissoes.forEach(comissao => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-700';
                row.innerHTML = `
                    <td class="px-6 py-4 text-white font-medium">${comissao.nomeCompleto}</td>
                    <td class="px-6 py-4 text-gray-300">${comissao.empresa}</td>
                    <td class="px-6 py-4 text-blue-400">${comissao.vendedor}</td>
                    <td class="px-6 py-4 text-green-400 font-medium">R$ ${comissao.comissaoTotal.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                    <td class="px-6 py-4 text-purple-400 font-medium">
                        R$ ${comissao.comissaoVendedor.toLocaleString('pt-BR', {minimumFractionDigits: 2})}
                        <span class="text-gray-400 text-xs block">(${comissao.percentualVendedor}%)</span>
                    </td>
                    <td class="px-6 py-4 text-gray-300">${comissao.dataPagamento}</td>
                `;
                tbody.appendChild(row);
            });
            
            if (comissoes.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="6" class="px-6 py-8 text-center text-gray-400">
                        <i class="fas fa-money-bill-wave text-4xl mb-2 block"></i>
                        Nenhuma comiss√£o registrada ainda
                        <p class="text-sm mt-2">As comiss√µes s√£o criadas automaticamente quando uma venda √© marcada como "Pagamento Efetuado"</p>
                    </td>
                `;
                tbody.appendChild(row);
            }
        }

        function initializeCancelamentoForm() {
            const form = document.getElementById('cancelamentoForm');
            if (!form) return;
            
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const id = document.getElementById('cancelamentoId').value;
                const cancelamentoData = {
                    nome: document.getElementById('cancelamentoNome').value,
                    empresa: document.getElementById('cancelamentoEmpresa').value,
                    valorEstorno: parseFloat(document.getElementById('cancelamentoValor').value),
                    data: new Date().toLocaleDateString('pt-BR'),
                    timestamp: Date.now(),
                    registradoPor: currentUser.nome
                };
                
                if (id) {
                    // Editar cancelamento existente
                    const index = cancelamentos.findIndex(c => c.id == id);
                    if (index !== -1) {
                        cancelamentos[index] = { ...cancelamentos[index], ...cancelamentoData };
                        createRealtimeNotification('success', 'Cancelamento Atualizado', `Dados de ${cancelamentoData.nome} foram atualizados`);
                    }
                } else {
                    // Criar novo cancelamento
                    const novoCancelamento = {
                        id: Date.now(),
                        ...cancelamentoData
                    };
                    
                    try {
                        // Salvar no Firebase
                        await database.ref(`cancelamentos/${novoCancelamento.id}`).set(novoCancelamento);
                        
                        createRealtimeNotification('warning', 
                            'Cancelamento Registrado', 
                            `Estorno de R$ ${cancelamentoData.valorEstorno.toLocaleString('pt-BR', {minimumFractionDigits: 2})} para ${cancelamentoData.nome}`
                        );
                        
                    } catch (error) {
                        console.error('Erro ao registrar cancelamento:', error);
                        createRealtimeNotification('error', 'Erro', 'N√£o foi poss√≠vel registrar o cancelamento');
                    }
                }
                
                updateCancelamentosTable();
                resetCancelamentoForm();
            });
        }

        function resetCancelamentoForm() {
            const form = document.getElementById('cancelamentoForm');
            if (form) {
                form.reset();
                document.getElementById('cancelamentoId').value = '';
            }
        }

        function updateCancelamentosTable() {
            const tbody = document.getElementById('cancelamentosTableBody');
            const countElement = document.getElementById('cancelamentosCount');
            const totalEstornosElement = document.getElementById('totalEstornos');
            const totalCancelamentosElement = document.getElementById('totalCancelamentos');
            const mediaCancelamentosElement = document.getElementById('mediaCancelamentos');
            
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            // Calcular totais
            const totalEstornos = cancelamentos.reduce((sum, c) => sum + c.valorEstorno, 0);
            const totalCancelamentosCount = cancelamentos.length;
            const mediaEstornos = totalCancelamentosCount > 0 ? totalEstornos / totalCancelamentosCount : 0;
            
            // Atualizar elementos de resumo
            if (countElement) {
                countElement.textContent = `${totalCancelamentosCount} cancelamentos`;
            }
            if (totalEstornosElement) {
                totalEstornosElement.textContent = `R$ ${totalEstornos.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
            }
            if (totalCancelamentosElement) {
                totalCancelamentosElement.textContent = totalCancelamentosCount;
            }
            if (mediaCancelamentosElement) {
                mediaCancelamentosElement.textContent = `R$ ${mediaEstornos.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
            }
            
            // Preencher tabela
            cancelamentos.forEach(cancelamento => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-700';
                row.innerHTML = `
                    <td class="px-6 py-4 text-white font-medium">${cancelamento.nome}</td>
                    <td class="px-6 py-4 text-gray-300">${cancelamento.empresa}</td>
                    <td class="px-6 py-4 text-red-400 font-medium">R$ ${cancelamento.valorEstorno.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</td>
                    <td class="px-6 py-4 text-gray-300">${cancelamento.data}</td>
                    <td class="px-6 py-4">
                        <button onclick="editarCancelamento(${cancelamento.id})" class="text-blue-400 hover:text-blue-300 mr-2">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button onclick="excluirCancelamento(${cancelamento.id})" class="text-red-400 hover:text-red-300">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            if (cancelamentos.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td colspan="5" class="px-6 py-8 text-center text-gray-400">
                        <i class="fas fa-check-circle text-4xl mb-2 block text-green-500"></i>
                        Nenhum cancelamento registrado! üéâ
                    </td>
                `;
                tbody.appendChild(row);
            }
        }

        function editarCancelamento(id) {
            const cancelamento = cancelamentos.find(c => c.id == id);
            if (!cancelamento) return;
            
            document.getElementById('cancelamentoId').value = cancelamento.id;
            document.getElementById('cancelamentoNome').value = cancelamento.nome;
            document.getElementById('cancelamentoEmpresa').value = cancelamento.empresa;
            document.getElementById('cancelamentoValor').value = cancelamento.valorEstorno;
            
            // Scroll para o formul√°rio
            document.getElementById('cancelamentoForm').scrollIntoView({ behavior: 'smooth' });
        }

        async function excluirCancelamento(id) {
            const cancelamento = cancelamentos.find(c => c.id == id);
            if (!cancelamento) return;
            
            const confirmResult = await customConfirm(
                'Excluir Cancelamento',
                `Tem certeza que deseja excluir o cancelamento de ${cancelamento.nome}?`
            );
            
            if (confirmResult) {
                try {
                    // Remover do Firebase
                    await database.ref(`cancelamentos/${id}`).remove();
                    
                    createRealtimeNotification('warning', 
                        'Cancelamento Exclu√≠do', 
                        `Cancelamento de ${cancelamento.nome} foi removido`
                    );
                    
                } catch (error) {
                    console.error('Erro ao excluir cancelamento:', error);
                    createRealtimeNotification('error', 'Erro', 'N√£o foi poss√≠vel excluir o cancelamento');
                }
            }
        }

        async function syncCancelamentos() {
            try {
                database.ref('cancelamentos').on('value', (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        cancelamentos = Object.values(data);
                        updateCancelamentosTable();
                    }
                });
            } catch (error) {
                console.error('Erro ao sincronizar cancelamentos:', error);
            }
        }

        // ===== SISTEMA DE RESET MENSAL AUTOM√ÅTICO =====
        function updateMonthlySalesCount() {
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            
            // Verificar se mudou o m√™s
            const lastResetMonth = localStorage.getItem('lastResetMonth');
            const lastResetYear = localStorage.getItem('lastResetYear');
            
            if (lastResetMonth != currentMonth || lastResetYear != currentYear) {
                // Resetar contadores mensais de todos os vendedores
                vendedoresData.forEach(vendedor => {
                    vendedor.vendasMesAtual = 0;
                    vendedor.ultimoResetMes = currentMonth;
                    vendedor.ultimoResetAno = currentYear;
                });
                
                // Salvar nova data de reset
                localStorage.setItem('lastResetMonth', currentMonth);
                localStorage.setItem('lastResetYear', currentYear);
                
                console.log('üîÑ Contadores mensais resetados para o novo m√™s');
                
                // Atualizar no Firebase
                vendedoresData.forEach(async (vendedor) => {
                    if (vendedor.id) {
                        await database.ref(`vendedores/${vendedor.id}`).update({
                            vendasMesAtual: 0,
                            ultimoResetMes: currentMonth,
                            ultimoResetAno: currentYear
                        });
                    }
                });
            }
            
            // Atualizar contadores baseado nas vendas do m√™s atual
            vendedoresData.forEach(vendedor => {
                const vendasDoMes = vendas.filter(venda => {
                    const vendaDate = new Date(venda.data.split('/').reverse().join('-'));
                    return vendaDate.getMonth() === currentMonth && 
                           vendaDate.getFullYear() === currentYear &&
                           venda.vendedor === vendedor.nome;
                }).length;
                
                vendedor.vendasMesAtual = vendasDoMes;
            });
        }

        // ===== FUN√á√ïES DE LINKS √öTEIS =====
        
        function initializeLinkForm() {
            const form = document.getElementById('linkForm');
            if (!form) return;
            
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                console.log('üìù Formul√°rio de link enviado');
                
                // Verificar se usu√°rio ainda est√° logado
                if (!currentUser) {
                    console.error('‚ùå Usu√°rio n√£o logado');
                    createRealtimeNotification('error', 'Sess√£o Expirada', 'Fa√ßa login novamente');
                    logout();
                    return;
                }
                
                // Verificar se sess√£o ainda √© v√°lida
                try {
                    const session = localStorage.getItem('currentUserSession');
                    if (!session) {
                        console.error('‚ùå Sess√£o n√£o encontrada');
                        createRealtimeNotification('error', 'Sess√£o Expirada', 'Fa√ßa login novamente');
                        logout();
                        return;
                    }
                    
                    const sessionData = JSON.parse(session);
                    const now = Date.now();
                    const sessionAge = now - sessionData.loginTime;
                    const maxSessionAge = 24 * 60 * 60 * 1000; // 24 horas
                    
                    if (sessionAge > maxSessionAge) {
                        console.error('‚ùå Sess√£o expirada');
                        createRealtimeNotification('error', 'Sess√£o Expirada', 'Sua sess√£o expirou. Fa√ßa login novamente');
                        logout();
                        return;
                    }
                } catch (error) {
                    console.error('‚ùå Erro ao validar sess√£o:', error);
                    createRealtimeNotification('error', 'Erro de Sess√£o', 'Fa√ßa login novamente');
                    logout();
                    return;
                }
                
                const id = document.getElementById('linkId').value;
                const linkData = {
                    nome: document.getElementById('linkNome').value.trim(),
                    url: document.getElementById('linkUrl').value.trim()
                };
                
                console.log('üìã Dados do link:', linkData);
                
                // Validar campos obrigat√≥rios
                if (!linkData.nome || !linkData.url) {
                    createRealtimeNotification('error', 'Campos Obrigat√≥rios', 'Preencha o nome e a URL do site');
                    return;
                }
                
                // Validar URL
                if (!linkData.url.startsWith('http://') && !linkData.url.startsWith('https://')) {
                    linkData.url = 'https://' + linkData.url;
                }
                
                try {
                    if (id) {
                        // Editar link existente
                        const index = linksUteis.findIndex(l => l.id == id);
                        if (index !== -1) {
                            linksUteis[index] = { ...linksUteis[index], ...linkData, lastUpdated: Date.now(), updatedBy: currentUser.nome };
                            
                            // Atualizar no Firebase se online
                            if (isOnline) {
                                try {
                                    await database.ref(`linksUteis/${id}`).update({
                                        ...linkData,
                                        lastUpdated: Date.now(),
                                        updatedBy: currentUser.nome
                                    });
                                    console.log('‚úÖ Link atualizado no Firebase');
                                } catch (firebaseError) {
                                    console.error('‚ö†Ô∏è Erro no Firebase, salvando localmente:', firebaseError);
                                }
                            }
                            
                            createRealtimeNotification('success', 'Link Atualizado', `${linkData.nome} foi atualizado`);
                        }
                    } else {
                        // Criar novo link
                        const novoLink = {
                            id: Date.now(),
                            ...linkData,
                            criadoEm: new Date().toLocaleDateString('pt-BR'),
                            criadoPor: currentUser.nome,
                            timestamp: Date.now()
                        };
                        
                        console.log('üíæ Criando novo link:', novoLink);
                        
                        // Adicionar ao array local primeiro
                        linksUteis.push(novoLink);
                        console.log('‚úÖ Link adicionado ao array local. Total:', linksUteis.length);
                        
                        // Salvar localmente como backup
                        saveData();
                        console.log('‚úÖ Dados salvos localmente');
                        
                        // Salvar no Firebase se online
                        if (isOnline) {
                            try {
                                await database.ref(`linksUteis/${novoLink.id}`).set(novoLink);
                                console.log('‚úÖ Link salvo no Firebase');
                            } catch (firebaseError) {
                                console.error('‚ö†Ô∏è Erro no Firebase, mantendo dados locais:', firebaseError);
                            }
                        } else {
                            console.log('‚ö†Ô∏è Offline - dados salvos apenas localmente');
                        }
                        
                        createRealtimeNotification('success', 'Link Adicionado', `${linkData.nome} foi adicionado aos links √∫teis`);
                    }
                    
                    // Atualizar interface
                    updateLinksGrid();
                    resetLinkForm();
                    
                    console.log('‚úÖ Opera√ß√£o de link conclu√≠da com sucesso');
                    
                } catch (error) {
                    console.error('‚ùå Erro ao salvar link:', error);
                    createRealtimeNotification('error', 'Erro', 'N√£o foi poss√≠vel salvar o link: ' + error.message);
                }
            });
        }
        
        function resetLinkForm() {
            const form = document.getElementById('linkForm');
            if (form) {
                form.reset();
                document.getElementById('linkId').value = '';
            }
        }
        
        function updateLinksGrid() {
            const grid = document.getElementById('linksGrid');
            const countElement = document.getElementById('linksCount');
            
            if (!grid) return;
            
            grid.innerHTML = '';
            
            if (countElement) {
                countElement.textContent = `${linksUteis.length} links`;
            }
            
            if (linksUteis.length === 0) {
                grid.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-link text-6xl text-gray-600 mb-4 block"></i>
                        <h3 class="text-xl font-bold text-gray-400 mb-2">Nenhum link salvo</h3>
                        <p class="text-gray-500">Adicione links √∫teis para facilitar o acesso r√°pido</p>
                    </div>
                `;
                return;
            }
            
            linksUteis.forEach(link => {
                const linkCard = document.createElement('div');
                linkCard.className = 'group relative bg-gradient-to-br from-gray-700 to-gray-800 rounded-xl border border-gray-600 hover:border-blue-500 transition-all duration-300 hover:shadow-lg hover:shadow-blue-500/20 hover:-translate-y-1 cursor-pointer overflow-hidden';
                
                // Extrair dom√≠nio para favicon
                let domain = '';
                try {
                    domain = new URL(link.url).hostname;
                } catch (e) {
                    domain = 'example.com';
                }
                
                linkCard.innerHTML = `
                    <!-- Efeito de brilho no hover -->
                    <div class="absolute inset-0 bg-gradient-to-r from-blue-600/0 via-blue-600/5 to-blue-600/0 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                    
                    <!-- Conte√∫do do card -->
                    <div class="relative p-6">
                        <!-- Header com favicon e a√ß√µes -->
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-gradient-to-br from-blue-600 to-purple-600 rounded-lg flex items-center justify-center shadow-lg">
                                    <img src="https://www.google.com/s2/favicons?domain=${domain}&sz=32" 
                                         alt="Favicon" 
                                         class="w-6 h-6"
                                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                                    <i class="fas fa-globe text-white text-lg hidden"></i>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <h3 class="text-lg font-bold text-white truncate group-hover:text-blue-300 transition-colors duration-200">${link.nome}</h3>
                                    <p class="text-sm text-gray-400 truncate">${domain}</p>
                                </div>
                            </div>
                            
                            <!-- A√ß√µes (vis√≠veis no hover) -->
                            <div class="flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                                <button onclick="event.stopPropagation(); editarLink(${link.id})" 
                                        class="p-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors duration-200"
                                        title="Editar">
                                    <i class="fas fa-edit text-xs"></i>
                                </button>
                                <button onclick="event.stopPropagation(); excluirLink(${link.id})" 
                                        class="p-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors duration-200"
                                        title="Excluir">
                                    <i class="fas fa-trash text-xs"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Bot√£o de acesso -->
                        <button onclick="abrirLink('${link.url}')" 
                                class="w-full bg-gradient-to-r from-blue-600 to-purple-600 hover:from-blue-700 hover:to-purple-700 text-white font-medium py-3 px-4 rounded-lg transition-all duration-200 flex items-center justify-center space-x-2 shadow-lg hover:shadow-xl">
                            <i class="fas fa-external-link-alt"></i>
                            <span>Acessar Site</span>
                        </button>
                        
                        <!-- Footer com data -->
                        <div class="mt-4 pt-3 border-t border-gray-600">
                            <div class="flex items-center justify-between text-xs text-gray-500">
                                <span>Criado por ${link.criadoPor || 'Sistema'}</span>
                                <span>${link.criadoEm || 'Data n√£o dispon√≠vel'}</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Indicador de hover -->
                    <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-600 to-purple-600 transform scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-left"></div>
                `;
                
                grid.appendChild(linkCard);
            });
        }
        
        function abrirLink(url) {
            window.open(url, '_blank', 'noopener,noreferrer');
        }
        
        function editarLink(id) {
            const link = linksUteis.find(l => l.id == id);
            if (!link) return;
            
            document.getElementById('linkId').value = link.id;
            document.getElementById('linkNome').value = link.nome;
            document.getElementById('linkUrl').value = link.url;
            
            // Scroll para o formul√°rio
            document.getElementById('linkForm').scrollIntoView({ behavior: 'smooth' });
        }
        
        async function excluirLink(id) {
            const link = linksUteis.find(l => l.id == id);
            if (!link) return;
            
            // Verificar se usu√°rio ainda est√° logado
            if (!currentUser) {
                createRealtimeNotification('error', 'Sess√£o Expirada', 'Fa√ßa login novamente');
                return;
            }
            
            const confirmResult = await customConfirm(
                'Excluir Link',
                `Tem certeza que deseja excluir o link "${link.nome}"?`
            );
            
            if (confirmResult) {
                try {
                    // Remover do array local primeiro
                    linksUteis = linksUteis.filter(l => l.id !== id);
                    
                    // Remover do Firebase se online
                    if (isOnline) {
                        try {
                            await database.ref(`linksUteis/${id}`).remove();
                        } catch (firebaseError) {
                            console.error('Erro no Firebase, removendo localmente:', firebaseError);
                        }
                    }
                    
                    // Salvar localmente
                    saveData();
                    
                    // Atualizar interface
                    updateLinksGrid();
                    
                    createRealtimeNotification('warning', 'Link Exclu√≠do', `${link.nome} foi removido dos links √∫teis`);
                    
                } catch (error) {
                    console.error('Erro ao excluir link:', error);
                    createRealtimeNotification('error', 'Erro', 'N√£o foi poss√≠vel excluir o link: ' + error.message);
                }
            }
        }

        // Dados j√° s√£o carregados na inicializa√ß√£o do sistema
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97a9ca4e2623f1c7',t:'MTc1NzExNzkxOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
